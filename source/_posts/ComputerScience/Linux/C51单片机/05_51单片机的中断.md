# 中断

1. 什么是中断

   中断是指CPU由于异常或外设IO请求从而暂停当前处理的程序，转而去处理异常或IO请求子程序，处理完毕后返回到当前程序的断点处继续执行原程序。引起中断的叫做中断源或中断请求，如异常、IO请求等，中断源又分为内部中断源和外部中断源。处理中断的部件叫做中断系统。

2. 什么是中断的优先级

   就是当CPU同时接收到多个中断请求后，然后根据请求的轻重缓急来优先处理情况比较急的中断，而中断的紧急程度由优先级来体现。拥有高优先级的中断请求先响应。

3. 中断仲裁--处理中断的策略问题

4. 什么是嵌套中断

   是指CPU暂停处理低优先级的中断服务程序，转而去处理优先级更高的中断服务程序，处理完毕后再回到低优先级的中断服务程序。

5. 什么是多级中断系统

   能够嵌套中断的系统叫做多级中断系统

6. 什么是单级中断系统

   不能嵌套中断的系统叫做单级中断系统

## 中断的优点

1. 解决快速主机和慢速IO设备之间的数据传送问题
2. 分时操作。CPU可以分时为多个IO设备服务，提高计算机的利用率
3. 实时响应。CPU能够随时的处理应用系统的随机事件，系统的实时性明显提高。
4. 可靠性高。
5. CPU 具有处理设备故障及掉电等突发性事件能力，从而使系统可靠性提高。

## 51单片机的中断

### STC89C52的中断结构

- 四个外部中断: `INT0`, `INT1`, `INT2`, `INT3`
- 三个定时器中断：`Timer0`, `Timer1`, `Timer2`
- 一个串口中断：`UART`

一般的51单片机有5个中断：2个外部中断，2个定时器中断，1个串口中断

用户可以用关总中断允许位(EA/IE.7)或相应中断的允许位来屏蔽所有的中断请求，也可以用打开相应的中断允许位来使CPU 响应相应的中断申请。

其中有些中断源可以用软件独立地控制为开中断或关中断状态。

每一个中断的优先级别均可用软件设置。

高优先级的中断请求可以打断低优先级的中断，反之，低优先级的中断请求不可以打断高优先级及同优先级的中断。

当两个相同优先级的中断同时产生时，将由查询次序来决定系统先响应哪个中断。

![image-20220527160642401](pic\image-20220527160642401.png)

通过设置新增加的特殊功能寄存器==IPH== 中的相应位，可将中断优先级设为四级，如果==只设置IP 或XICON==，那么中断优先级就只有两级，与传统8051 单片机两级中断优先级完全兼容。==上图中的中断查询次序即为中断号，这个中断号在编程时非常重要，当中断来临时，只有中断号正确才能进入中断。==

下面我们以51 单片机均有的5 个中断来介绍，其内部结构框图如下所示：

![image-20220527161139493](pic\image-20220527161139493.png)

①INT0 对应的是==P3.2== 口的附加功能，可由IT0(TCON.0)选择其为低电平有效还是下降沿有效。当CPU 检测到P3.2 引脚上出现有效的中断信号时，中断标志IE0(TCON.1)置1，向CPU 申请中断。

②INT1 对应的是==P3.3== 口的附加功能，可由IT1(TCON.2)选择其为低电平有效还是下降沿有效。当CPU 检测到P3.3 引脚上出现有效的中断信号时，中断标志IE1(TCON.3)置1,向CPU 申请中断。

③T0 对应的是==P3.4== 口的附加功能，TF0（TCON.5）,片内定时/计数器T0 ==溢出中断请求标志==。当定时/计数器T0 发生溢出时，置位TF0，并向CPU 申请中断。

④T1 对应的是==P3.5== 口的附加功能，TF1（TCON.7），片内定时/计数器T1溢出中断请求标志。当定时/计数器T1 发生溢出时，置位TF1，并向CPU 申请中断。

⑤RXD 和TXD 对应的是==P3.0==和==P3.1== 口的附加功能，RI（SCON.0）或TI
（SCON.1），==串行口中断请求标志==。当串行口==接收完==一帧串行数据时置位RI 或当串行口==发送完==一帧串行数据时置位TI，向CPU 申请中断。

### 开启、关闭和设置中断的寄存器

#### 中断允许标志IE

CPU 对中断系统所有中断以及某个中断源的开放和屏蔽是由中断允许寄存器IE 控制的。

![image-20220527162127466](pic\image-20220527162127466.png)

EX0(IE.0)，外部中断0 允许位；
ET0(IE.1)，定时/计数器T0 中断允许位；
EX1(IE.2)，外部中断0 允许位；
ET1(IE.3)，定时/计数器T1 中断允许位；
ES（IE.4)，串行口中断允许位；
EA (IE.7)， CPU 中断允许（总允许）位。

#### 中断控制标志TCON

![image-20220527162408269](pic\image-20220527162408269.png)

IT0（TCON.0），外部中断0 触发方式控制位。
	当IT0=0 时，为电平触发方式。
	当IT0=1 时，为边沿触发方式（下降沿有效）。
IE0（TCON.1），外部中断0 中断请求标志位。
IT1（TCON.2），外部中断1 触发方式控制位。
IE1（TCON.3），外部中断1 中断请求标志位。
TF0（TCON.5），定时/计数器T0 溢出中断请求标志位。
TF1（TCON.7），定时/计数器T1 溢出中断请求标志位。

#### 中断优先级

同一优先级中的中断申请不止一个时，则有中断优先权排队问题。同一优先级的中断优先权排队，由中断系统硬件确定的自然优先级形成，其排列如所示：

![image-20220527162630686](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20220527162630686.png)

#### 中断号

![image-20220527162645550](pic\image-20220527162645550.png)

#### 中断响应条件

①中断源有中断请求；
②此中断源的中断允许位为1；
③CPU 开中断（即EA=1）。

以上三条同时满足时，CPU 才有可能响应中断。在使用中断时我们需要做什
么呢？

①你想使用的中断是哪个？选择相应的中断号；
②你所希望的触发条件是什么？
③你希望在中断之后干什么？

















