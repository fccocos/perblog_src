---
title: 5_C_预处理
date: 2022/4/8/ 8:00
categories:
  - 计算机科学
tags:
  - 嵌入式
  - C语言
  - 笔记
sticky: true
valine:
  placeholder: "1. 提问前请先仔细阅读本文档⚡\n2. 页面显示问题💥，请提供控制台截图📸或者您的测试网址\n3. 其他任何报错💣，请提供详细描述和截图📸，祝食用愉快💪"
---



# 预处理 

## C语言编译过程

```shell
gcc -E hello.c -o hello.i # 预处理
gcc -S hello.i -o hello.s # 编译
gcc -c hello.s -o hello.o # 汇编
gcc hello.o -o hello_elf  # 链接
```

1. 预处理阶段

   将源文件中的头文件展开、宏展开，生成的文件为.i文件

2. 编译阶段

   将预处理后的.i文件生成.s汇编文件

3. 汇编阶段

   将.s汇编文件生成.o目标文件

4. 链接阶段

   将.o目标文件连接生成可执行文件

## include

#include<>，用尖括号包含的头文件，在系统制定的路径下找头文件

#include ""，用双引号包含的头文件，先在当前目录下找头文件，找不到，再到系统指定的路径下找

注意：

1. include经常用来包含头文件，可以包含.c文件，但是大家不要包含.c文文件，因为include包含的文件会在预编译阶段进行展开，如果一个.c文件被多次包含，多次展开，会导致函数重复定义，因此不要包含.c文件
2. 预处理只对include等预处理操作进行处理并不会进行语法检查，这个阶段有语法错误不会报错，第二阶段即编译阶段才会进行语法检查

## define

定义宏，用 define 去定义

宏是在预编译的时候进行替换

1. 不带参宏

​		`#define PI 3.12`

​		在预编译的时候如果代码中出现了PI就用3.14去替换。

​		宏的好处就是：只需要修改宏定义，其他地方在预编译的时候就会		重新替换

​		注意：宏定义后边不要加分号

​		宏定义的作用范围，从定义的地方到文本末尾

​		如果现在中间终止宏的定义范围，可以使用`#undef PI`终止PI的作		用

2. 带参宏

​		`#defien S(a,b) a*b`

​		注意带参宏的的形参没有类型名

​		`		S(2,4)`将来在预处理阶段的时候替换成 实参替换字符串的形参，其		他字保留，2*4

​		注意：宏定义只是简单的替换，不会自动添加括号

3. 带参宏和带参函数的区别

​		带参宏被调用多少次就会展开多少次，执行代码的时候没用函数调		用的过程，不需要压栈弹栈。所以带参宏是浪费了空间，因为被展		开多次，节省时间。

​		带参函数，代码只有一份，存在代码段，调用的时候去代码段取指		令，调用的时候，要弹栈压栈。有一个调用的过程，因此带参函数		浪费了时间，节省了空间。

​		带参函数的形参是有类型的，带参宏的参数是没有类型的。

## 选择性编译

1. 

```c
#ifdef AAA
	代码段一
#else
     代码段二
#endif
```

如果当前.c文件的ifdef 上边定义过 AAA，就编译代码段一，否则编译代码段二

注意和`if else`语句的区别，`if else`语句都会被编译，通过条件选择型执行代码，而选择性编译只有一块代码被编译

2. 

```c
#ifndef AAA
	代码段一
#else
     代码段二
#endif
```

和第一种互补

这种方法，经常用在防止头文件重复包含

3. 

```c
#if 表达式
	代码段一
#else
    代码段二
#endif
```

如果表达式为真，编译第一段代码，否则编译第二段代码

选择性编译都是在预编译阶段干的事情