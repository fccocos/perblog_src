---
title: 08_C++_STL
date: 2022/4/18/ 16:00
categories:
  - è®¡ç®—æœºç§‘å­¦
tags:
  - åµŒå…¥å¼
  - C++è¯­è¨€
  - ç¬”è®°
sticky: true
valine:
  placeholder: "1. æé—®å‰è¯·å…ˆä»”ç»†é˜…è¯»æœ¬æ–‡æ¡£âš¡\n2. é¡µé¢æ˜¾ç¤ºé—®é¢˜ğŸ’¥ï¼Œè¯·æä¾›æ§åˆ¶å°æˆªå›¾ğŸ“¸æˆ–è€…æ‚¨çš„æµ‹è¯•ç½‘å€\n3. å…¶ä»–ä»»ä½•æŠ¥é”™ğŸ’£ï¼Œè¯·æä¾›è¯¦ç»†æè¿°å’Œæˆªå›¾ğŸ“¸ï¼Œç¥é£Ÿç”¨æ„‰å¿«ğŸ’ª"
---



# C++STL

## STLæ¦‚è¿°

é•¿ä¹…ä»¥æ¥ï¼Œè½¯ä»¶ç•Œä¸€ç›´å¸Œæœ›å»ºç«‹ä¸€ç§å¯é‡å¤åˆ©ç”¨çš„ä¸œè¥¿ï¼Œä»¥åŠä¸€ç§å¾—ä»¥åˆ¶é€ å‡ºâ€å¯é‡å¤è¿ç”¨çš„ä¸œè¥¿â€çš„æ–¹æ³•ï¼Œè®©ç¨‹åºå‘˜çš„å¿ƒè¡€ä¸æ­¢äºéšæ—¶é—´çš„è¿ç§»ï¼Œäººäº‹å¼‚åŠ¨è€ŒçƒŸæ¶ˆäº‘æ•£ï¼Œä»å‡½æ•°(functions),ç±»åˆ«(classes),å‡½æ•°åº“(function libraries),ç±»åˆ«åº“(class libraries)ã€å„ç§ç»„ä»¶ï¼Œä»æ¨¡å—åŒ–è®¾è®¡ï¼Œåˆ°é¢å‘å¯¹è±¡(object oriented),ä¸ºçš„å°±æ˜¯å¤ç”¨æ€§çš„æå‡ã€‚

å¤ç”¨æ€§å¿…é¡»å»ºç«‹åœ¨æŸç§æ ‡å‡†ä¹‹ä¸Šã€‚ä½†æ˜¯åœ¨è®¸å¤šç¯å¢ƒä¸‹ï¼Œå°±è¿è½¯ä»¶å¼€å‘æœ€åŸºæœ¬çš„æ•°æ®ç»“æ„(data structures)å’Œç®—æ³•(algorithm)éƒ½æœªèƒ½æœ‰ä¸€å¥—æ ‡å‡†ã€‚å¤§é‡ç¨‹åºå‘˜è¢«è¿«ä»äº‹å¤§é‡é‡å¤çš„å·¥ä½œï¼Œç«ç„¶æ˜¯ä¸ºäº†å®Œæˆå‰äººå·±ç»å®Œæˆè€Œè‡ªå·±æ‰‹ä¸Šå¹¶æœªæ‹¥æœ‰çš„ç¨‹åºä»£ç ï¼Œè¿™ä¸ä»…æ˜¯äººåŠ›èµ„æºçš„æµªè´¹ï¼Œä¹Ÿæ˜¯æŒ«æŠ˜ä¸ç—›è‹¦çš„æ¥æºã€‚

ä¸ºäº†å»ºç«‹æ•°æ®ç»“æ„å’Œç®—æ³•çš„ä¸€å¥—æ ‡å‡†ï¼Œå¹¶ä¸”é™ä½ä»–ä»¬ä¹‹é—´çš„è€¦åˆå…³ç³»ï¼Œä»¥æå‡å„è‡ªçš„ç‹¬ç«‹æ€§ã€å¼¹æ€§ã€äº¤äº’æ“ä½œæ€§ï¼ˆç›¸
äº’åˆä½œæ€§ï¼Œinteroperability),è¯ç”Ÿäº†sTLã€‚

## STLåŸºæœ¬æ¦‚å¿µ

STL(Standard Template Library,æ ‡å‡†æ¨¡æ¿åº“)ï¼Œæ˜¯æƒ æ™®å®éªŒå®¤å¼€å‘çš„ä¸€ç³»åˆ—è½¯ä»¶çš„ç»Ÿç§°ã€‚ç°åœ¨ä¸»è¦å‡ºç°åœ¨c++ä¸­ï¼Œä½†æ˜¯åœ¨å¼•å…¥c+ä¹‹å‰è¯¥æŠ€æœ¯å·²ç»å­˜åœ¨å¾ˆé•¿æ—¶é—´äº†ã€‚

STLä»å¹¿ä¹‰ä¸Šåˆ†ä¸ºï¼šå®¹å™¨(container)ã€ç®—æ³•(algorithm)ã€è¿­ä»£å™¨(iterator),å®¹å™¨å’Œç®—æ³•ä¹‹é—´é€šè¿‡è¿­ä»£å™¨è¿›è¡Œæ— ç¼è¿æ¥ã€‚

STLå‡ ä¹æ‰€æœ‰çš„ä»£ç éƒ½é‡‡ç”¨äº†æ¨¡æ¿ç±»æˆ–è€…æ¨¡æ¿å‡½æ•°ï¼Œè¿™ç›¸æ¯”ä¼ ç»Ÿçš„ç”±å‡½æ•°å’Œç±»ç»„æˆçš„åº“æ¥è¯´æä¾›äº†æ›´å¥½çš„ä»£ç é‡ç”¨æœºä¼šã€‚STL(Standard Template Library)æ ‡å‡†æ¨¡æ¿åº“ï¼Œåœ¨æˆ‘ä»¬c+æ ‡å‡†ç¨‹åºåº“ä¸­éš¶å±äºSTLçš„å åˆ°äº†80%ä»¥ä¸Šã€‚

## STLçš„å…­å¤§ç»„ä»¶ç®€ä»‹

STLæä¾›äº†å…­å¤§ç»„ä»¶ï¼Œå½¼æ­¤ä¹‹é—´å¯ä»¥ç»„åˆå¥—ç”¨ï¼Œè¿™å…­å¤§ç»„ä»¶åˆ†åˆ«æ˜¯ï¼šå®¹å™¨ã€ç®—æ³•ã€è¿­ä»£å™¨ã€ä»¿å‡½æ•°ã€é€‚é…å™¨ï¼ˆé…æ¥å™¨)ã€ç©ºé—´é…ç½®å™¨ã€‚

- å®¹å™¨ï¼šå„ç§æ•°æ®ç»“æ„ï¼Œå¦‚vectorã€.lstã€dequeã€setã€mapç­‰ï¼Œç”¨æ¥å­˜æ”¾æ•°æ®ï¼Œä»å®ç°è§’åº¦æ¥çœ‹ï¼ŒSTLå®¹å™¨æ˜¯ä¸€ç§class template.

- ç®—æ³•ï¼šå„ç§å¸¸ç”¨çš„ç®—æ³•ï¼Œå¦‚sortã€findã€copyã€for_eachã€‚ä»å®ç°çš„è§’åº¦æ¥çœ‹ï¼ŒsTLç®—æ³•æ˜¯ä¸€ç§function template.

- è¿­ä»£å™¨ï¼šæ‰®æ¼”äº†å®¹å™¨ä¸ç®—æ³•ä¹‹é—´çš„èƒ¶åˆå‰‚ï¼Œå…±æœ‰äº”ç§ç±»å‹ï¼Œä»å®ç°è§’åº¦æ¥çœ‹ï¼Œè¿­ä»£å™¨æ˜¯ä¸€ç§å°†operator*,operator->,operator++,operator--ç­‰æŒ‡é’ˆç›¸å…³æ“ä½œäºˆä»¥é‡è½½çš„class template.,æ‰€æœ‰STLå®¹å™¨éƒ½é™„å¸¦æœ‰è‡ªå·±ä¸“å±çš„è¿­ä»£å™¨ï¼Œåªæœ‰å®¹å™¨çš„è®¾è®¡è€…æ‰çŸ¥é“å¦‚ä½•éå†è‡ªå·±çš„å…ƒç´ ã€‚åŸç”ŸæŒ‡é’ˆ(native pointer)ä¹Ÿæ˜¯ä¸€ç§è¿­ä»£å™¨ã€‚

- ä»¿å‡½æ•°ï¼šæœ¬è´¨æ˜¯å‡½æ•°å¯¹è±¡ï¼Œè¡Œä¸ºç±»ä¼¼å‡½æ•°ï¼Œå¯ä½œä¸ºç®—æ³•çš„æŸç§ç­–ç•¥ã€‚ä»å®ç°è§’åº¦æ¥çœ‹ï¼Œä»¿å‡½æ•°æ˜¯ä¸€ç§é‡è½½äº†operator()çš„classæˆ–è€…class template

- é€‚é…å™¨ï¼šä¸€ç§ç”¨æ¥ä¿®é¥°å®¹å™¨æˆ–è€…ä»¿å‡½æ•°æˆ–è¿­ä»£å™¨æ¥å£çš„ä¸œè¥¿ï¼ˆä¸€èˆ¬ç”¨æ¥æ‰©å±•å‚æ•°æ¥å£ï¼‰ã€‚

- ç©ºé—´é…ç½®å™¨ï¼šè´Ÿè´£ç©ºé—´çš„é…ç½®ä¸ç®¡ç†ã€‚ä»å®ç°è§’åº¦çœ‹ï¼Œé…ç½®å™¨æ˜¯ä¸€ä¸ªå®ç°äº†åŠ¨æ€ç©ºé—´é…ç½®ã€ç©ºé—´ç®¡ç†ã€ç©ºé—´é‡Šæ”¾çš„class template

STLå…­å¤§ç»„ä»¶çš„äº¤äº’å…³ç³»ï¼Œå®¹å™¨é€šè¿‡ç©ºé—´é…ç½®å™¨å–å¾—æ•°æ®å­˜å‚¨ç©ºé—´ï¼Œç®—æ³•é€šè¿‡è¿­ä»£å™¨å­˜å‚¨å®¹å™¨ä¸­çš„å†…å®¹ï¼Œä»¿å‡½æ•°å¯ä»¥ååŠ©ç®—æ³•å®Œæˆä¸åŒçš„ç­–ç•¥çš„å˜åŒ–ï¼Œé€‚é…å™¨å¯ä»¥ä¿®é¥°ä»¿å‡½æ•°ã€‚

## STLçš„ä¼˜ç‚¹

STLæ˜¯C++çš„ä¸€éƒ¨åˆ†ï¼Œå› æ­¤ä¸ç”¨é¢å¤–å®‰è£…ä»€ä¹ˆï¼Œå®ƒè¢«å†…å»ºåœ¨ä½ çš„ç¼–è¯‘å™¨ä¹‹å†…ã€‚

STLçš„ä¸€ä¸ªé‡è¦ç‰¹æ€§æ˜¯å°†æ•°æ®å’Œæ“ä½œåˆ†ç¦»ã€‚æ•°æ®ç”±å®¹å™¨ç±»åˆ«åŠ ä»¥ç®¡ç†ï¼Œæ“ä½œåˆ™ç”±å¯å®šåˆ¶çš„ç®—æ³•å®šä¹‰ã€‚è¿­ä»£å™¨åœ¨ä¸¤è€…ä¹‹é—´å……å½“â€œç²˜åˆå‰‚â€ä»¥ä½¿ç®—æ³•å¯ä»¥å’Œå®¹å™¨äº¤äº’è¿ä½œã€‚

ç¨‹åºå‘˜å¯ä»¥ä¸ç”¨æ€è€ƒSTLå…·ä½“çš„å®ç°è¿‡ç¨‹ï¼Œåªè¦èƒ½å¤Ÿç†Ÿç»ƒä½¿ç”¨STLå°±OKäº†ã€‚è¿™æ ·ä»–ä»¬å°±å¯ä»¥æŠŠç²¾åŠ›æ”¾åœ¨ç¨‹åºå¼€å‘çš„åˆ«çš„æ–¹é¢ã€‚

STLå…·æœ‰**é«˜å¯é‡ç”¨æ€§**ï¼Œ**é«˜æ€§èƒ½**ï¼Œ**é«˜ç§»æ¤æ€§**ï¼Œ**è·¨å¹³å°**çš„ä¼˜ç‚¹ã€‚

- é«˜å¯é‡ç”¨æ€§ï¼šSTLä¸­å‡ ä¹æ‰€æœ‰çš„ä»£ç éƒ½é‡‡ç”¨äº†æ¨¡æ¿ç±»å’Œæ¨¡ç‰ˆå‡½æ•°çš„æ–¹å¼å®ç°ï¼Œè¿™ç›¸æ¯”äºä¼ ç»Ÿçš„ç”±å‡½æ•°å’Œç±»ç»„æˆçš„åº“æ¥è¯´æä¾›äº†æ›´å¥½çš„ä»£ç é‡ç”¨æœºä¼šã€‚å…³äºæ¨¡æ¿çš„çŸ¥è¯†ï¼Œå·²ç»ç»™å¤§å®¶ä»‹ç»äº†ã€‚

- é«˜æ€§èƒ½ï¼šå¦‚mapå¯ä»¥é«˜æ•ˆåœ°ä»åä¸‡æ¡è®°å½•é‡Œé¢æŸ¥æ‰¾å‡ºæŒ‡å®šçš„è®°å½•ï¼Œå› ä¸ºmapæ˜¯é‡‡ç”¨çº¢é»‘æ ‘çš„å˜ä½“å®ç°çš„ã€‚

- é«˜ç§»æ¤æ€§ï¼šå¦‚åœ¨é¡¹ç›®Aä¸Šç”¨STLç¼–å†™çš„æ¨¡å—ï¼Œå¯ä»¥ç›´æ¥ç§»æ¤åˆ°é¡¹ç›®Bä¸Šã€‚

## STLçš„ä¸‰å¤§ç»„ä»¶

### å®¹å™¨

å®¹å™¨ï¼Œç½®ç‰©ä¹‹æ‰€ä¹Ÿã€‚

ç ”ç©¶æ•°æ®çš„ç‰¹å®šæ’åˆ—æ–¹å¼ï¼Œä»¥åˆ©äºæœç´¢æˆ–æ’åºæˆ–å…¶ä»–ç‰¹æ®Šç›®çš„ï¼Œè¿™ä¸€é—¨å­¦ç§‘æˆ‘ä»¬ç§°ä¸ºæ•°æ®ç»“æ„ã€‚å¤§å­¦ä¿¡æ¯ç±»ç›¸å…³ä¸“ä¸šé‡Œé¢ï¼Œä¸ç¼–ç¨‹æœ€æœ‰ç›´æ¥å…³ç³»çš„å­¦ç§‘ï¼Œé¦–æ¨æ•°æ®ç»“æ„ä¸ç®—æ³•ã€‚å‡ ä¹å¯ä»¥è¯´ä»»ä½•ç‰¹å®šçš„æ•°æ®ç»“æ„éƒ½æ˜¯ä¸ºäº†å®ç°æŸç§ç‰¹å®šçš„ç®—æ³•ã€‚STLå®¹å™¨å°±æ˜¯å°†è¿ç”¨æœ€å¹¿æ³›çš„ä¸€äº›æ•°æ®ç»“æ„å®ç°å‡ºæ¥ã€‚

å¸¸ç”¨çš„æ•°æ®ç»“æ„ï¼šæ•°ç»„(array),é“¾è¡¨(list),tree(æ ‘)ï¼Œæ ˆ(stack),é˜Ÿåˆ—(queue),é›†åˆ(set),æ˜ å°„è¡¨(map),æ ¹æ®æ•°æ®åœ¨å®¹å™¨ä¸­çš„æ’åˆ—ç‰¹æ€§ï¼Œè¿™äº›æ•°æ®åˆ†ä¸ºåºåˆ—å¼å®¹å™¨å’Œå…³è”å¼å®¹å™¨ä¸¤ç§ã€‚

åºåˆ—å¼å®¹å™¨å¼ºè°ƒå€¼çš„æ’åºï¼Œåºåˆ—å¼å®¹å™¨ä¸­çš„æ¯ä¸ªå…ƒç´ å‡æœ‰å›ºå®šçš„ä½ç½®ï¼Œé™¤éç”¨åˆ é™¤æˆ–æ’å…¥çš„æ“ä½œæ”¹å˜è¿™ä¸ªä½ç½®ã€‚

Vectorå®¹å™¨ã€Dequeå®¹å™¨ã€Listå®¹å™¨ç­‰ã€‚

å…³è”å¼å®¹å™¨æ˜¯éçº¿æ€§çš„æ ‘ç»“æ„ï¼Œæ›´å‡†ç¡®çš„è¯´æ˜¯äºŒå‰æ ‘ç»“æ„ã€‚å„å…ƒç´ ä¹‹é—´æ²¡æœ‰ä¸¥æ ¼çš„ç‰©ç†ä¸Šçš„é¡ºåºå…³ç³»ï¼Œä¹Ÿå°±æ˜¯è¯´å…ƒç´ åœ¨å®¹å™¨ä¸­å¹¶æ²¡æœ‰ä¿å­˜å…ƒç´ ç½®å…¥å®¹å™¨æ—¶çš„é€»è¾‘é¡ºåºã€‚å…³è”å¼å®¹å™¨å¦ä¸€ä¸ªæ˜¾è‘—ç‰¹ç‚¹æ˜¯ï¼šåœ¨å€¼ä¸­é€‰æ‹©ä¸€ä¸ªå€¼ä½œä¸ºå…³é”®å­—key,è¿™ä¸ªå…³é”®å­—å¯¹å€¼èµ·åˆ°ç´¢å¼•çš„ä½œç”¨ï¼Œæ–¹ä¾¿æŸ¥æ‰¾ã€‚Set/multisetå®¹å™¨Map/multimapå®¹å™¨ã€‚

å®¹å™¨å¯ä»¥åµŒå¥—å®¹å™¨ï¼

### ç®—æ³•

ç®—æ³•ï¼Œé—®é¢˜ä¹‹è§£æ³•ä¹Ÿã€‚

ä»¥æœ‰é™çš„æ­¥éª¤ï¼Œè§£å†³é€»è¾‘æˆ–æ•°å­¦ä¸Šçš„é—®é¢˜ï¼Œè¿™ä¸€é—¨å­¦ç§‘æˆ‘ä»¬å«åšç®—æ³•(Algorithms),

å¹¿ä¹‰è€Œè¨€ï¼Œæˆ‘ä»¬æ‰€ç¼–å†™çš„æ¯ä¸ªç¨‹åºéƒ½æ˜¯ä¸€ä¸ªç®—æ³•ï¼Œå…¶ä¸­çš„æ¯ä¸ªå‡½æ•°ä¹Ÿéƒ½æ˜¯ä¸€ä¸ªç®—æ³•ï¼Œæ¯•ç«å®ƒä»¬éƒ½æ˜¯ç”¨æ¥è§£å†³æˆ–å¤§æˆ–å°çš„é€»è¾‘é—®é¢˜æˆ–æ•°å­¦é—®é¢˜ã€‚

STLæ”¶å½•çš„ç®—æ³•ç»è¿‡äº†æ•°å­¦ä¸Šçš„æ•ˆèƒ½åˆ†æä¸è¯æ˜ï¼Œæ˜¯æå…·å¤ç”¨ä»·å€¼çš„ï¼ŒåŒ…æ‹¬å¸¸ç”¨çš„æ’åºï¼ŒæŸ¥æ‰¾ç­‰ç­‰ã€‚ç‰¹å®šçš„ç®—æ³•å¾€å¾€æ­é…ç‰¹å®šçš„æ•°æ®ç»“æ„ï¼Œç®—æ³•ä¸æ•°æ®ç»“æ„ç›¸è¾…ç›¸æˆã€‚

ç®—æ³•åˆ†ä¸ºï¼šè´¨å˜ç®—æ³•å’Œéè´¨å˜ç®—æ³•ã€‚

è´¨å˜ç®—æ³•ï¼šæ˜¯æŒ‡è¿ç®—è¿‡ç¨‹ä¸­ä¼šæ›´æ”¹åŒºé—´å†…çš„å…ƒç´ çš„å†…å®¹ã€‚ä¾‹å¦‚æ‹·è´ï¼Œæ›¿æ¢ï¼Œåˆ é™¤ç­‰ç­‰

éè´¨å˜ç®—æ³•ï¼šæ˜¯æŒ‡è¿ç®—è¿‡ç¨‹ä¸­ä¸ä¼šæ›´æ”¹åŒºé—´å†…çš„å…ƒç´ å†…å®¹ï¼Œä¾‹å¦‚æŸ¥æ‰¾ã€è®¡æ•°ã€éå†ã€å¯»æ‰¾æå€¼ç­‰ç­‰

### è¿­ä»£å™¨

è¿­ä»£å™¨(iterator)æ˜¯ä¸€ç§æŠ½è±¡çš„è®¾è®¡æ¦‚å¿µï¼Œç°å®ç¨‹åºè¯­è¨€ä¸­å¹¶æ²¡æœ‰ç›´æ¥å¯¹åº”äºè¿™ä¸ªæ¦‚å¿µçš„å®ç‰©ã€‚åœ¨<>ä¸€ä¹¦ä¸­æä¾›äº†23ä¸­è®¾è®¡æ¨¡å¼çš„å®Œæ•´æè¿°ï¼Œå…¶ä¸­iteratoræ¨¡å¼å®šä¹‰å¦‚ä¸‹ï¼š**æä¾›ä¸€ç§æ–¹æ³•ï¼Œä½¿ä¹‹èƒ½å¤Ÿä¾åºå¯»è®¿æŸä¸ªå®¹å™¨æ‰€å«çš„å„ä¸ªå…ƒç´ ï¼Œè€Œåˆæ— éœ€æš´éœ²è¯¥å®¹å™¨çš„å†…éƒ¨è¡¨ç¤ºæ–¹å¼ã€‚**

è¿­ä»£å™¨çš„è®¾è®¡æ€ç»´æ˜¯STLçš„å…³é”®æ‰€åœ¨ï¼ŒSTLçš„ä¸­å¿ƒæ€æƒ³åœ¨äºå°†å®¹å™¨(container)å’Œç®—æ³•(algorithms)åˆ†å¼€ï¼Œå½¼æ­¤ç‹¬ç«‹è®¾è®¡ï¼Œæœ€åå†ä¸€è´´èƒ¶ç€å‰‚å°†ä»–ä»¬æ’®åˆåœ¨ä¸€èµ·ã€‚ä»æŠ€æœ¯è§’åº¦æ¥çœ‹ï¼Œå®¹å™¨å’Œç®—æ³•çš„æ³›å‹åŒ–å¹¶ä¸å›°éš¾ï¼Œc++çš„class templateå’Œfunction templateå¯åˆ†åˆ«è¾¾åˆ°ç›®æ ‡ï¼Œå¦‚ä½•è®¾è®¡å‡ºä¸¤ä¸ªä¹‹é—´çš„è‰¯å¥½çš„èƒ¶ç€å‰‚ï¼Œæ‰æ˜¯å¤§éš¾é¢˜ã€‚
è¿­ä»£å™¨çš„ç§ç±»ï¼š

- **è¾“å…¥è¿­ä»£å™¨**    æä¾›å¯¹æ•°æ®çš„åªè¯»è®¿é—®    åªè¯»ï¼Œæ”¯æŒ`++`ã€`=+`ã€`!=`
- **è¾“å‡ºè¿­ä»£å™¨**    æä¾›å¯¹æ•°æ®çš„åªå†™è®¿é—®    åªå†™ï¼Œæ”¯æŒ`++`
- **å‰å‘è¿­ä»£å™¨**    æä¾›è¯»å†™æ“ä½œï¼Œå¹¶èƒ½å‘å‰æ¨è¿›è¿­ä»£å™¨    è¯»å†™ï¼Œæ”¯æŒ`++`ã€`==`ã€`!=`
- **åŒå‘è¿­ä»£å™¨**    æä¾›è¯»å†™æ“ä½œï¼Œå¹¶èƒ½å‘å‰å’Œå‘åæ“ä½œ    è¯»å†™ï¼Œæ”¯æŒ`++`ã€`--`
- **éšæœºè®¿é—®è¿­ä»£å™¨**    æä¾›è¯»å†™æ“ä½œï¼Œå¹¶èƒ½ä»¥è·³è·ƒçš„æ–¹å¼è®¿é—®å®¹å™¨çš„ä»»æ„æ•°æ®ï¼Œæ˜¯åŠŸèƒ½æœ€å¼ºçš„è¿­ä»£å™¨    è¯»å†™ï¼Œæ”¯æŒ`++`ã€`--`ã€`[n]`ã€`-n`ã€`<`ã€`<=`ã€`>`ã€`>=`

ç»ƒä¹ 1ï¼š`v.begin()å’Œv.end()`

```c++
#include <iostream>
#include <vector>
using namespace std;

void test01()
{
    vector<int> v;//æœ¬è´¨æ˜¯ä¸€ä¸ªåŠ¨æ€æ•°ç»„
    v.push_back(2);//å°¾æ’å…ƒç´ 
    v.push_back(3);
    v.push_back(5);
    v.push_back(7);
    //è‹¥è¦è®¿é—®å®¹å™¨å†…çš„å®¹å™¨ éœ€è¦æ‹¿åˆ°è¯¥å®¹å™¨çš„è¿­ä»£å™¨(æŒ‡é’ˆ)
    vector<int>::iterator it_start = v.begin();//è·å–å®¹å™¨çš„èµ·å§‹è¿­ä»£å™¨ï¼Œå®ƒæŒ‡å‘å®¹å™¨çš„ç¬¬ä¸€å…ƒç´ ã€‚
    vector<int<::iterator it_end = v.end();////è·å–å®¹å™¨çš„æœ«å°¾è¿­ä»£å™¨ï¼Œå®ƒæŒ‡å‘å®¹å™¨çš„æœ€åä¸€ä¸ªå…ƒç´ çš„ä¸‹ä¸€ä¸ªä½ç½®ã€‚
    for(;it_start!=it_end; ++it_start)
        cout<<*it_start<<" ";
    cout<<endl;
}
```

ç»ƒä¹ 2ï¼šè¿­ä»£å™¨é€šè¿‡`for_each`éå†

```c++
#include <iostream>
#include <vector>
#include <alogthms>
using namespace std;
void print(int a)
{
    cout<<a<<endl;
}
void test01()
{
    vector<int> v;//æœ¬è´¨æ˜¯ä¸€ä¸ªåŠ¨æ€æ•°ç»„
    v.push_back(2);//å°¾æ’å…ƒç´ 
    v.push_back(3);
    v.push_back(5);
    v.push_back(7);
    //è‹¥è¦è®¿é—®å®¹å™¨å†…çš„å®¹å™¨ éœ€è¦æ‹¿åˆ°è¯¥å®¹å™¨çš„è¿­ä»£å™¨(æŒ‡é’ˆ)
    vector<int>::iterator it_start = v.begin();//è·å–å®¹å™¨çš„èµ·å§‹è¿­ä»£å™¨ï¼Œå®ƒæŒ‡å‘å®¹å™¨çš„ç¬¬ä¸€å…ƒç´ ã€‚
    vector<int<::iterator it_end = v.end();////è·å–å®¹å™¨çš„æœ«å°¾è¿­ä»£å™¨ï¼Œå®ƒæŒ‡å‘å®¹å™¨çš„æœ€åä¸€ä¸ªå…ƒç´ çš„ä¸‹ä¸€ä¸ªä½ç½®ã€‚
    for_each(it_start, it_end, print);
}
```

ç»ƒä¹ 3ï¼šå®¹å™¨ä¸­å­˜æ”¾çš„æ˜¯è‡ªå®šç±»å‹ï¼Œå¦‚ä½•ä½¿ç”¨è¿­ä»£å™¨è®¿é—®å…ƒç´ 

```c++
class person
{
public:
    person(int age)
    {
        this->age = age;
    }
    int age;
}
void test01()
{
    vector<person> v;
    person p1(1);
    person p2(2);
    person p3(3);
    person p4(4);
    v.push_back(p1);
    v.push_back(p2);
    v.push_back(p3);
    v.push_back(p4);
    vector<person>::iterator start = v.start();
    vector<person>::iterator end = v.end();
    for(;start!=end; ++start)
        cout<< (*start).age<<" ";
    cout<<endl;
    
}
```



ç»ƒä¹ 4: å®¹å™¨åµŒå¥—å®¹å™¨

```c++
void test01()
{
    vector<int> child1, child2,child3,child4;
    vector<vector<int>> parent;
    parent.push_back(child1);
    parent.push_back(child2);
    parent.push_back(child3);
    parent.push_back(child4);
    child1.push_back(1);
    child2.push_back(1);
    child3.push_back(1);
    child4.push_back(1);
    
    vector<vector<int>>::iterator p_start = parent.start();//è·å–çš„æ˜¯çˆ¶å®¹å™¨çš„é¦–å…ƒç´ çš„è¿­ä»£å™¨
    vector<vector<int>>::iterator p_end = parent.end();//è·å–çš„æ˜¯çˆ¶å®¹å™¨çš„æœ«å°¾å…ƒç´ ä¸‹ä¸€ä¸ªä½ç½®çš„è¿­ä»£å™¨
    for(;p_start!=p_end; ++p_start)
    {
        vector<int>::iterator c_start = (*p_start).begin();//è·å–çš„æ˜¯å­å®¹å™¨çš„é¦–å…ƒç´ çš„è¿­ä»£å™¨
        vector<int>::iterator c_end = (*p_start).end();//è·å–çš„æ˜¯å­å®¹å™¨çš„é¦–å…ƒç´ çš„è¿­ä»£å™¨
        cout<<"åœ¨ç¬¬"<<p_start<<"ä¸ªå­å®¹å™¨ä¸­çš„å…ƒç´ :"<<endl;
        for(;c_start!=c_end; ++c_start)
        {
            cout<<*c_start<<" ";
        }
        cout<<endl;
        
    }
    
}
```

## å¸¸ç”¨å®¹å™¨

### stringå®¹å™¨

#### stringå®¹å™¨åŸºæœ¬æ¦‚å¿µ

cé£æ ¼å­—ç¬¦ä¸²ï¼ˆä»¥ç©ºå­—ç¬¦ç»“å°¾çš„å­—ç¬¦æ•°ç»„ï¼‰å¤ªè¿‡å¤æ‚éš¾äºæŒæ¡ï¼Œä¸é€‚åˆå¤§ç¨‹åºçš„å¼€å‘ï¼Œæ‰€ä»¥c+æ ‡å‡†åº“å®šä¹‰äº†ä¸€ç§stringç±»ï¼Œå®šä¹‰åœ¨å¤´æ–‡ä»¶`#include<string>`ã€‚

**Stringå’Œcé£æ ¼å­—ç¬¦ä¸²å¯¹æ¯”**ï¼š

- Char*æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒStringæ˜¯ä¸€ä¸ªç±»
  stringå°è£…äº†char,ç®¡ç†è¿™ä¸ªå­—ç¬¦ä¸²ï¼Œæ˜¯ä¸€ä¸ªcharå‹çš„å®¹å™¨ã€‚*
- Stringå°è£…äº†å¾ˆå¤šå®ç”¨çš„æˆå‘˜æ–¹æ³•
  æŸ¥æ‰¾find,æ‹·è´copy,åˆ é™¤deleteæ›¿æ¢replace,æ’å…¥insert
- ä¸ç”¨è€ƒè™‘å†…å­˜é‡Šæ”¾å’Œè¶Šç•Œ
  stringç®¡ç†char*æ‰€åˆ†é…çš„å†…å­˜ã€‚æ¯ä¸€æ¬¡stringçš„å¤åˆ¶ï¼Œå–å€¼éƒ½ç”±stringç±»è´Ÿè´£ç»´æŠ¤ï¼Œä¸ç”¨æ‹…å¿ƒå¤åˆ¶è¶Šç•Œå’Œå–å€¼è¶Šç•Œç­‰ã€‚ç®—æ³•

#### stringå®¹å™¨å¸¸ç”¨æ“ä½œ

#####  stringæ„é€ å‡½æ•°

```c++
string();//å‡åˆ›å»ºä¸€ä¸ªç©ºçš„å­—ç¬¦ä¸²ä¾‹å¦‚ï¼šstring str.
string(const stringe&str);//ä½¿ç”¨ä¸€ä¸ªstringå¯¹è±¡åˆå§‹åŒ–å¦ä¸€ä¸ªstringå¯¹è±¡
string(const char*s);//ä½¿ç”¨å­—ç¬¦ä¸²såˆå§‹åŒ–
string(int n,char c);//ä½¿ç”¨nä¸ªå­—ç¬¦cåˆå§‹åŒ–
```

#####  stringåŸºæœ¬èµ‹å€¼æ“ä½œ

```c++
string& perator=(const chari* s);//char*ç±»å‹å­—ç¬¦ä¸²èµ‹å€¼ç»™å½“å‰çš„å­—ç¬¦ä¸²
string& operator=(const string& s);//æŠŠå­—ç¬¦ä¸²sèµ‹ç»™å½“å‰çš„å­—ç¬¦ä¸²
string& operator=(char c);//å­—ç¬¦èµ‹å€¼ç»™å½“å‰çš„å­—ç¬¦ä¸²
string& assign(const char* s);//æŠŠå­—ç¬¦ä¸²sèµ‹ç»™å½“å‰çš„å­—ç¬¦ä¸²
string& assign(const char* s,int n);//æŠŠå­—ç¬¦ä¸²sçš„å‰nä¸ªå­—ç¬¦èµ‹ç»™å½“å‰çš„å­—ç¬¦ä¸²
string& assign(const string& s);//æŠŠå­—ç¬¦ä¸²sèµ‹ç»™å½“å‰å­—ç¬¦ä¸²
string& assign(int n,char c);//ç”¨nä¸ªå­—ç¬¦cèµ‹ç»™å½“å‰å­—ç¬¦ä¸²
string& assign(const string& s,int start,,int n);//å°†sä»startå¼€å§‹nä¸ªå­—ç¬¦å€¼ç»™å­—ç¬¦ä¸²
```

##### stringå­˜å™¨å­—ç¬¦ä¸²æ“ä½œ

```c++
char& operator[](int n);//é€šè¿‡[]æ–¹å¼è·å–å­—ç¬¦
char& at(int n);//é€šè¿‡atæ–¹æ³•è·å–å­—ç¬¦ä¸²
```

##### stringæ‹¼æ¥æ“ä½œ

```c++
string& operator+=(const string& str);//é‡æ‰¾+=æ“ä½œç¬¦
string& operator+=(const char* str);//é‡æ‰¾+=æ“ä½œç¬¦
string& operator+=(const char c);//é‡æ‰¾+=æ“ä½œç¬¦
string& append(const char* s);//æŠŠå­—ç¬¦ä¸²sè¿æ¥åˆ°å½“å‰å­—ç¬¦ä¸²ç»“å°¾
string& append(const char* s,int n);//æŠŠå­—ç¬¦ä¸²sçš„å‰nä¸ªå­—ç¬¦è¿æ¥åˆ°å½“å‰å­—ç¬¦ä¸²ç»“å°¾
string& append(const string &s);//åŒoperator+=()
string& append(const string &s,int pos,int n);//æŠŠå­—ç¬¦ä¸²sä¸­ä»poså¼€å§‹çš„nä¸ªå­—ç¬¦è¿æ¥åˆ°å½“å‰å­—ç¬¦ä¸²ç»“å°¾
string& append(int n,char c);//åœ¨å½“å‰å­—ç¬¦ä¸²ç»“å°¾æ·»åŠ nä¸ªå­—ç¬¦c
```

##### stringæŸ¥æ‰¾å’Œæ›¿æ¢

```c++
int find(const string &str, int pos=0)const;//æŸ¥æ‰¾strç¬¬ä¸€æ¬¡å‡ºç°ä½ç½®ï¼Œä»poså¼€å§‹æŸ¥æ‰¾
int find(const char* s,int pos=0)const;//æŸ¥æ‰¾sç¬¬ä¸€æ¬¡å‡ºç°ä½ç½®ï¼Œä»poså¼€å§‹æŸ¥æ‰¾
int find(const char* s,int pos,int n)const;//ä»posä½ç½®æŸ¥æ‰¾sçš„å‰nä¸ªå­—ç¬¦ç¬¬ä¸€æ¬¡ä½ç½®
int find(const char c,int pos=0)const,;//æŸ¥æ‰¾å­—ç¬¦cç¬¬ä¸€æ¬¡å‡ºç°ä½ç½®
int rfind(const string& str,int pos=npos)const;//æŸ¥æ‰¾stræœ€åä¸€æ¬¡ä½ç½®ï¼Œä»poså¼€å§‹æŸ¥æ‰¾
int rfind(const char* s,int pos=npos)const;//æŸ¥æ‰¾sæœ€åä¸€æ¬¡å‡ºç°ä½ç½®ï¼Œä»poså¼€å§‹æŸ¥æ‰¾
int rfind(const char* s,int pos,int n)const;//ä»posæŸ¥æ‰¾sçš„å‰nä¸ªå­—ç¬¦æœ€åä¸€æ¬¡ä½ç½®
int rfind(const char c,int pos=e)const;//æŸ¥æ‰¾å­—ç¬¦cæœ€åä¸€æ¬¡å‡ºç°ä½ç½®
string& replace(int pos,int n,const string& str);//æ›¿æ¢ä»poså¼€å§‹nä¸ªå­—ç¬¦ä¸ºå­—ç¬¦ä¸²str
stringe& repLace(int pos,int n,const char*s);//æ›¿æ¢ä»poså¼€å§‹çš„nä¸ªå­—ç¬¦ä¸ºå­—ç¬¦ä¸²s


```

#####  stringæ¯”è¾ƒæ“ä½œ

```c++
/*
compareå‡½æ•°åœ¨æ—¶è¿”å›1ï¼Œ<æ—¶è¿”å›-1ï¼Œ==æ—¶è¿”å›0ã€‚
æ¯”è¾ƒåŒºåˆ†å¤§å°å†™ï¼Œæ¯”è¾ƒæ—¶å‚è€ƒå­—å…¸é¡ºåºï¼Œæ’è¶Šå‰é¢çš„è¶Šå°ã€‚
å¤§å†™çš„Aæ¯”å°å†™çš„aå°ã€‚
*/
int compare(const string& s)const;//ä¸å­—ç¬¦ä¸²sæ¯”è¾ƒ
int compare(const char* s)const;//ä¸å­—ç¬¦ä¸²slæ¯”è¾ƒ
```

##### stringå­ä¸²

```c++
string substr(int pos=0,intn=npos)const;/è¿”å›ç”±poså¼€å§‹çš„nä¸ªå­—ç¬¦ç»„æˆçš„å­—ç¬¦ä¸²
```

#####  stringæ’å…¥å’Œåˆ é™¤æ“ä½œ

```c++
string&insert(int pos,const char*s);//æ’å…¥å­—ç¬¦ä¸²
string&insert(int pos,const string &str);//æ’å…¥å­—ç¬¦ä¸²
string&insert(int pos,int n,char c);//åœ¨æŒ‡å®šä½ç½®æ’å…¥nä¸ªå­—ç¬¦c
stringe&erase(int pos,int n=npos);//åˆ«é™¤ä»Poså¼€å§‹çš„nä¸ªå­—ç¬¦
```

##### stringå’Œc-styleå­—ç¬¦ä¸²è½¬æ¢

```c++
//stringè½¬char*
string str = "itcast";
const char*cstr str.c_str();
//char*è½¬string
char*s =  "itcast";
string str(s);
```

åœ¨c++ä¸­å­˜åœ¨ä¸€ä¸ªä»const charåˆ°stringçš„éšå¼ç±»å‹è½¬æ¢ï¼Œå´ä¸å­˜åœ¨ä»ä¸€ä¸ªstringå¯¹è±¡åˆ°C_stringçš„è‡ªåŠ¨ç±»å‹è½¬æ¢ã€‚å¯¹äºstringç±»å‹çš„å­—ç¬¦ä¸²ï¼Œå¯ä»¥é€šè¿‡c_str()å‡½æ•°è¿”å›stringå¯¹è±¡å¯¹åº”çš„C_stringã€‚

é€šå¸¸ï¼Œç¨‹åºå‘˜åœ¨æ•´ä¸ªç¨‹åºä¸­åº”åšæŒä½¿ç”¨stringç±»å¯¹è±¡ï¼Œç›´åˆ°å¿…é¡»å°†å†…å®¹è½¬åŒ–ä¸ºcharæ—¶æ‰å°†å…¶è½¬æ¢ä¸ºC_stringã€‚

æç¤ºï¼š

ä¸ºäº†ä¿®æ”¹stringå­—ç¬¦ä¸²çš„å†…å®¹ï¼Œä¸‹æ ‡æ“ä½œç¬¦0å’Œatéƒ½ä¼šè¿”å›å­—ç¬¦çš„å¼•ç”¨ã€‚ä½†å½“å­—ç¬¦ä¸²çš„å†…å­˜è¢«é‡æ–°åˆ†é…ä¹‹åï¼Œå¯èƒ½å‘ç”Ÿé”™è¯¯ã€‚

### vectorå®¹å™¨

#### vectorå®¹å™¨åŸºæœ¬æ¦‚å¿µ

vectorçš„æ•°æ®å®‰æ’ä»¥åŠæ“ä½œæ–¹å¼ï¼Œä¸arrayéå¸¸ç›¸ä¼¼ï¼Œä¸¤è€…çš„å”¯ä¸€å·®åˆ«åœ¨äºç©ºé—´çš„è¿ç”¨çš„çµæ´»æ€§ã€‚Arrayæ˜¯é™æ€ç©ºé—´ä¸€æ—¦é…ç½®äº†å°±ä¸èƒ½æ”¹å˜ï¼Œè¦æ¢å¤§ä¸€ç‚¹æˆ–è€…å°ä¸€ç‚¹çš„ç©ºé—´ï¼Œå¯ä»¥ï¼Œä¸€åˆ‡çç¢å¾—ç”±è‡ªå·±æ¥ï¼Œé¦–å…ˆé…ç½®ä¸€å—æ–°çš„ç©ºé—´ï¼Œç„¶åå°†æ—§ç©ºé—´çš„æ•°æ®æ¬å¾€æ–°ç©ºé—´ï¼Œå†é‡Šæ”¾åŸæ¥çš„ç©ºé—´ã€‚Vectoræ˜¯åŠ¨æ€ç©ºé—´ï¼Œéšç€å…ƒç´ çš„åŠ å…¥ï¼Œå®ƒçš„å†…éƒ¨æœºåˆ¶ä¼šè‡ªåŠ¨æ‰©å……ç©ºé—´ä»¥å®¹çº³æ–°å…ƒç´ ã€‚å› æ­¤vectorçš„è¿ç”¨å¯¹äºå†…å­˜çš„åˆç†åˆ©ç”¨ä¸è¿ç”¨çš„çµæ´»æ€§æœ‰å¾ˆå¤§çš„å¸®åŠ©ï¼Œæˆ‘ä»¬å†ä¹Ÿä¸å¿…å®³æ€•ç©ºé—´ä¸è¶³è€Œä¸€å¼€å§‹å°±è¦æ±‚ä¸€ä¸ªå¤§å—å¤´çš„arrayäº†ã€‚

Vectorçš„å®ç°æŠ€æœ¯ï¼Œå…³é”®åœ¨äºå…¶å¯¹å¤§å°çš„æ§åˆ¶ä»¥åŠé‡æ–°é…ç½®æ—¶çš„æ•°æ®ç§»åŠ¨æ•ˆç‡ï¼Œä¸€æ—¦vectoræ—§ç©ºé—´æ»¡äº†ï¼Œå¦‚æœå®¢æˆ·æ¯æ–°å¢ä¸€ä¸ªå…ƒç´ ï¼Œvectorå†…éƒ¨åªæ˜¯æ‰©å……ä¸€ä¸ªå…ƒç´ çš„ç©ºé—´ï¼Œå®ä¸ºä¸æ™ºï¼Œå› ä¸ºæ‰€è°“çš„æ‰©å……ç©ºé—´ï¼ˆä¸è®ºå¤šå¤§ï¼‰ï¼Œä¸€å¦‚åˆšæ‰æ‰€è¯´ï¼Œæ˜¯â€é…ç½®æ–°ç©ºé—´:arrow_right:æ•°æ®ç§»åŠ¨:arrow_right:é‡Šæ”¾æ—§ç©ºé—´â€çš„å¤§å·¥ç¨‹ï¼Œæ—¶é—´æˆæœ¬å¾ˆé«˜ï¼Œåº”è¯¥åŠ å…¥æŸç§æœªé›¨ç»¸ç¼ªçš„è€ƒè™‘ï¼Œç¨åæˆ‘ä»¬ä¾¿å¯ä»¥çœ‹åˆ°vectorçš„ç©ºé—´é…ç½®ç­–ç•¥ã€‚

![image-20220421083301676](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20220421083301676.png)

#### vectorè¿­ä»£å™¨

Vectorç»´æŠ¤ä¸€ä¸ªçº¿æ€§ç©ºé—´ï¼Œæ‰€ä»¥ä¸è®ºå…ƒç´ çš„å‹åˆ«å¦‚ä½•ï¼Œæ™®é€šæŒ‡é’ˆéƒ½å¯ä»¥ä½œä¸ºvectorçš„è¿­ä»£å™¨ï¼Œå› ä¸ºvectorè¿­ä»£å™¨æ‰€éœ€è¦çš„æ“ä½œè¡Œä¸ºï¼Œå¦‚`operator.` ,`operator->`, `operator++`, `operator--`, `operator+`, `operator-`, `operator+=`ä¸`operator-=`, æ™®é€šæŒ‡é’ˆå¤©ç”Ÿå…·å¤‡ã€‚Vectoræ”¯æŒéšæœºå­˜å–ï¼Œè€Œæ™®é€šæŒ‡é’ˆæ­£æœ‰ç€è¿™æ ·çš„èƒ½åŠ›ã€‚æ‰€ä»¥vectoræä¾›çš„æ˜¯éšæœºè®¿é—®é€ä»£å™¨RandomAccess Iterators).

#### vectorçš„æ•°æ®ç»“æ„

Vectoræ‰€é‡‡ç”¨çš„æ•°æ®ç»“æ„éå¸¸ç®€å•ï¼Œçº¿æ€§è¿ç»­ç©ºé—´ï¼Œå®ƒä»¥ä¸¤ä¸ªè¿­ä»£å™¨Myfirstå’ŒMylaståˆ†åˆ«æŒ‡å‘é…ç½®å¾—æ¥çš„è¿ç»­ç©ºé—´ä¸­ç›®å‰å·²è¢«ä½¿ç”¨çš„èŒƒå›´ï¼Œå¹¶ä»¥è¿­ä»£å™¨_MyendæŒ‡å‘æ•´å—è¿ç»­å†…å­˜ç©ºé—´çš„å°¾ç«¯ã€‚

ä¸ºäº†é™ä½ç©ºé—´é…ç½®æ—¶çš„é€Ÿåº¦æˆæœ¬ï¼Œvectorå®é™…é…ç½®çš„å¤§å°å¯èƒ½æ¯”å®¢æˆ·ç«¯éœ€æ±‚å¤§ä¸€äº›ï¼Œä»¥å¥‹å°†æ¥å¯èƒ½çš„æ‰©å……ï¼Œè¿™è¾¹æ˜¯å®¹é‡çš„æ¦‚å¿µã€‚æ¢å¥è¯è¯´ï¼Œä¸€ä¸ªvectorçš„å®¹é‡æ°¸è¿œå¤§äºæˆ–ç­‰äºå…¶å¤§å°ï¼Œä¸€æ—¦å®¹é‡ç­‰äºå¤§å°ï¼Œä¾¿æ˜¯æ»¡è½½ï¼Œä¸‹æ¬¡å†æœ‰æ–°å¢å…ƒç´ ï¼Œæ•´ä¸ªvectorå®¹å™¨å°±å¾—å¦è§…å±…æ‰€ã€‚

æ³¨æ„ï¼š

æ‰€è°“åŠ¨æ€å¢åŠ å¤§å°ï¼Œå¹¶ä¸æ˜¯åœ¨åŸç©ºé—´ä¹‹åç»­æ¥æ–°ç©ºé—´ï¼ˆå› ä¸ºæ— æ³•ä¿è¯åŸç©ºé—´ä¹‹åå°šæœ‰å¯é…ç½®çš„ç©ºé—´ï¼‰ï¼Œè€Œæ˜¯ä¸€å—æ›´å¤§çš„å†…å­˜ç©ºé—´ï¼Œç„¶åå°†åŸæ•°æ®æ‹·è´æ–°ç©ºé—´ï¼Œå¹¶é‡Šæ”¾åŸç©ºé—´ã€‚å› æ­¤ï¼Œ**å¯¹vectorçš„ä»»ä½•æ“ä½œï¼Œä¸€æ—¦å¼•èµ·ç©ºé—´çš„é‡æ–°é…ç½®ï¼ŒæŒ‡å‘åŸvectorçš„æ‰€æœ‰è¿­ä»£å™¨å°±éƒ½å¤±æ•ˆäº†ã€‚**è¿™æ˜¯ç¨‹åºå‘˜å®¹æ˜“çŠ¯çš„ä¸€ä¸ªé”™è¯¯ï¼ŒåŠ¡å¿…å°å¿ƒã€‚

#### vectorå¸¸ç”¨APIæ“ä½œ

#####  vectoræ„é€ å‡½æ•°

```c++
vector<T> v;//é‡‡ç”¨æ¨¡æ¿å®ç°ç±»å®ç°ï¼Œé»˜è®¤æ„é€ å‡½æ•°
vector(v.begin(),v.end());//å°†v[begin(),end()]åŒºé—´ä¸­çš„å…ƒç´ æ‹·è´ç»™æœ¬èº«ã€‚
vector(n,eLem);//æ„é€ å‡½æ•°å°†nä¸ªeLemæ‹·è´ç»™æœ¬èº«ã€‚
vector(const vector &vec);//æ‹·è´æ„é€ å‡½æ•°
```

##### vectorå¸¸ç”¨èµ‹å€¼æ“ä½œ

```c++
assign(begin,end);//å°†[beg,end)åŒºé—´ä¸­çš„æ•°æ®æ‹·è´èµ‹å€¼ç»™æœ¬èº«ã€‚
assign(n,elem);//å°†nä¸ªelemæ‹·è´èµ‹å€¼ç»™æœ¬èº«ã€‚
vectore& operator=(const vector&vec);//é‡è½½ç­‰å·æ“ä½œç¬¦
swap(vec);//å°†vecä¸æœ¬èº«çš„å…ƒç´ äº’æ¢,åªæ˜¯äº¤æ¢äº†æŒ‡é’ˆçš„æŒ‡å‘
```

#####  vectorå¤§å°æ“ä½œ

```c++
size();//è¿”å›å®¹å™¨ä¸­å…ƒç´ çš„ä¸ªæ•°
empty();//åˆ¤æ–­å®¹å™¨æ˜¯å¦ä¸ºç©º
resize(int num);//é‡æ–°æŒ‡å®šå®¹å™¨çš„é•¿åº¦ä¸ºnum,è‹¥å®¹å™¨å˜é•¿ï¼Œåˆ™ä»¥é»˜è®¤å€¼å¡«å……æ–°ä½ç½®ã€‚å¦‚æœå®¹å™¨å˜çŸ­ï¼Œåˆ™æœ«å°¾è¶…å‡ºå®¹å™¨é•¿åº¦çš„å…ƒç´ è¢«åˆ é™¤ã€‚
resize(int num,eLem);//é‡æ–°æŒ‡å®šå®¹å™¨çš„é•¿åº¦ä¸ºnum,è‹¥å®¹å™¨å˜é•¿ï¼Œåˆ™ä»¥eLemå€¼å¡«å……æ–°ä½ç½®ã€‚å¦‚æœå®¹å™¨å˜çŸ­ï¼Œåˆ™æœ«å°¾è¶…å‡ºå®¹å™¨é•¿åº¦çš„å…ƒç´ è¢«åˆ é™¤ã€‚
capacity();//å®¹å™¨çš„å®¹é‡
reserve(int len);//å®¹å™¨é¢„ç•™lenä¸ªå…ƒç´ é•¿åº¦ï¼Œé¢„ç•™ä½ç½®ä¸åˆå§‹åŒ–ï¼Œå…ƒç´ ä¸å¯è®¿é—®ã€‚
```

##### vectoræ•°æ®å­˜å–æ“ä½œ

```c++
at(int idx);//è¿”å›ç´¢å¼•idxæ‰€æŒ‡çš„æ•°æ®ï¼Œå¦‚æœidxè¶Šç•Œï¼ŒæŠ›å‡ºout_of_rangeå¼‚å¸¸
operator[];//è¿”å›ç´¢å¼•idxæ‰€æŒ‡çš„æ•°æ®ï¼Œè¶Šç•Œæ—¶ï¼Œè¿è¡Œç›´æ¥æŠ¥é”™
front();//è¿”å›å®¹å™¨ä¸­ç¬¬ä¸€ä¸ªæ•°æ®å…ƒç´ 
back();//è¿”å›å®¹å™¨ä¸­æœ€åä¸€ä¸ªæ•°æ®å…ƒç´ 
```

##### vectoræ’å…¥å’Œåˆ é™¤æ“ä½œ

```c++
insert(const_iterator pos,int count, ele);//é€ä»£å™¨æŒ‡å‘ä½ç½®posæ’å…¥countä¸ªå…ƒç´ ele.
push_back(eLe);//å°¾éƒ¨æ’å…¥å…ƒç´ eLe
pop_back();//åˆ«é™¤æœ€åä¸€ä¸ªå…ƒç´ 
erase(const_iterator start,.const_iterator end);//æ“¦é™¤è¿­ä»£å™¨ä»startåˆ°endä¹‹é—´çš„å…ƒç´ 
erase(const_.iterator pos);//æ“¦é™¤è¿­ä»£å™¨æŒ‡å‘çš„å…ƒç´ 
clear();//æ¸…é™¤å®¹å™¨ä¸­æ‰€æœ‰å…ƒç´ 
```

##### æ¡ˆä¾‹1ï¼šå·§ç”¨swapå‡½æ•°å‹ç¼©å†…å­˜ç©ºé—´

```c++
void test()
{
    vector<int> v1;
    for(int i = 0; i < 10000; i++)
        v1.push_back(i);
    cout<<v1.size()<<" "<<v1.capacity()<<endl;//10000 10136
    v1.resize(10);
    cout<<v1.size()<<" "<<v1.capacity()<<endl;//10 10136
    vector<int>(v1).swap(v1);//ä¸åŒ¿åå¯¹è±¡äº¤æ¢ç©ºé—´ï¼ŒåŒ¿åå¯¹è±¡åœ¨åˆ›å»ºçš„è¡Œå°±ä¼šè¢«é”€æ¯ï¼Œäº¤æ¢åˆ°åŒ¿åå¯¹è±¡çš„ç©ºé—´ä¼šè¢«é‡Šæ”¾ 
    cout<<v1.size()<<" "<<v1.capacity()<<endl;//10 10
}
```

##### æ¡ˆä¾‹2ï¼šè®¡ç®—é‡æ–°å¼€è¾Ÿå†…å­˜ç©ºé—´çš„æ¬¡æ•°

```c++
void test()
{
    vector<int> v;
    int *p = NULL;
    int count = 0;
    for(int i = 0; i < 10000; ++i)
    {
        v.push_back(i);
        if(p!=&v[0])
        {
            cout++;
            p = &v[0];
        }
    }
}
```

##### æ¡ˆä¾‹3ï¼švectorå®¹å™¨æ’åº

```c++
#include <alorgthms>
#include <vector>

int compare(int a, int b)
{
    return a<b;
}

void print(int a)
{
    cout<<a<<endl;
}

void test()
{
    vector<int> v;
    v.push_back(8);
    v.push_back(49);
    v.push_back(1);
    v.push_back(2);
    v.push_back(5);
    v.push_back(4);
    v.push_back(4);
    sort(v.begin(), v.end());//é»˜è®¤å‡åºæ’åˆ—
    sort(v.begin(), v.end(), compare);//æ ¹æ®å‡½æ•°compareçš„åŠŸèƒ½æ¥æ’åº
    for_each(v.begin(), v.end(), print);
}
```



## ç®—æ³•

### å‡½æ•°å¯¹è±¡(ä»¿å‡½æ•°)

é‡è½½å‡½æ•°è°ƒç”¨æ“ä½œç¬¦çš„ç±»ï¼Œå…¶å¯¹è±¡å¸¸ç§°ä¸ºå‡½æ•°å¯¹è±¡(function object),å³å®ƒä»¬æ˜¯è¡Œä¸ºç±»ä¼¼å‡½æ•°çš„å¯¹è±¡ï¼Œä¹Ÿå«ä»¿å‡½æ•°(functor)),å…¶å®å°±æ˜¯é‡è½½"()â€æ“ä½œç¬¦ï¼Œä½¿å¾—ç±»å¯¹è±¡å¯ä»¥åƒå‡½æ•°é‚£æ ·è°ƒç”¨ã€‚

æ³¨æ„ï¼š

1. å‡½æ•°å¯¹è±¡ï¼ˆä»¿å‡½æ•°ï¼‰æ˜¯ä¸€ä¸ªç±»ï¼Œä¸æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚
2. å‡½æ•°å¯¹è±¡ï¼ˆä»¿å‡½æ•°ï¼‰é‡è½½äº†"()â€æ“ä½œç¬¦ä½¿å¾—å®ƒå¯ä»¥åƒå‡½æ•°ä¸€æ ·è°ƒç”¨ã€‚

åˆ†ç±»ï¼š

å‡å®šæŸä¸ªç±»æœ‰ä¸€ä¸ªé‡è½½çš„operator(),è€Œä¸”é‡è½½çš„operator(ï¼‰è¦æ±‚è·å–ä¸€ä¸ªå‚æ•°ï¼Œæˆ‘ä»¬å°±å°†è¿™ä¸ªç±»ç§°ä¸ºâ€ä¸€å…ƒä»¿å‡½æ•°â€(unary functor)ï¼›ç›¸åï¼Œå¦‚æœé‡è½½çš„operator()è¦æ±‚è·å–ä¸¤ä¸ªå‚æ•°ï¼Œå°±å°†è¿™ä¸ªç±»ç§°ä¸ºâ€œäºŒå…ƒä»¿å‡½æ•°â€(binary
functor)

å‡½æ•°å¯¹è±¡çš„ä½œç”¨ä¸»è¦æ˜¯ä»€ä¹ˆï¼ŸSTLæä¾›çš„ç®—æ³•å¾€å¾€éƒ½æœ‰ä¸¤ä¸ªç‰ˆæœ¬ï¼Œå…¶ä¸­ä¸€ä¸ªç‰ˆæœ¬è¡¨ç°å‡ºæœ€å¸¸ç”¨çš„æŸç§è¿ç®—ï¼Œå¦ä¸€ç‰ˆæœ¬åˆ™å…è®¸ç”¨æˆ·é€šè¿‡templateå‚æ•°çš„å½¢å¼æ¥æŒ‡å®šæ‰€è¦é‡‡å–çš„ç­–ç•¥ã€‚

é€šè¿‡å¯¹è±¡å‡½æ•°æ¥æŒ‡å®šç®—æ³•æ‰€é‡‡å–çš„ç­–ç•¥

```c++
#include <vector>
#include <alogthms>
#include <string>
class Print
{
public:
    void operator()(int a){cout<<a<<endl;}
};
class Compare
{
public:
    int operator()(int a, int b){return a>b;}
}
void test()
{
    vector<int> v;
    v.push_back(5);
    v.push_back(6);
    v.push_back(5);
    v.push_back(4);
    v.push_back(1);
    for_each(v.begin(), v.end(), Print());//Print()ä¸ºåŒ¿åå¯¹è±¡
    sort(v.begin(), v.end(), Compare());//Compare()ä¸ºåŒ¿åå¯¹è±¡--->Compare().operator()(int,int);
    for_each(v.begin(), v.end(), Print());//Print()ä¸ºåŒ¿åå¯¹è±¡ --->Print().operator()(int);
}
```



### è°“è¯

è°“è¯æ˜¯æŒ‡æ™®é€šå‡½æ•°æˆ–é‡è½½çš„operator()**è¿”å›å€¼æ˜¯boolç±»å‹**çš„**å‡½æ•°å¯¹è±¡**ï¼ˆä»¿å‡½æ•°ï¼‰ã€‚å¦‚æœoperatoræ¥å—ä¸€ä¸ªå‚æ•°ï¼Œé‚£ä¹ˆå«åšä¸€å…ƒè°“è¯ï¼Œå¦‚æœæ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œé‚£ä¹ˆå«åšäºŒå…ƒè°“è¯ï¼Œè°“è¯å¯ä½œä¸ºä¸€ä¸ªåˆ¤æ–­å¼ã€‚

### å†…ç½®çš„å‡½æ•°å¯¹è±¡ï¼ˆä»¿å‡½æ•°ï¼‰





STLå†…å»ºäº†ä¸€äº›å‡½æ•°å¯¹è±¡ã€‚åˆ†ä¸ºï¼šç®—æ•°ç±»å‡½æ•°å¯¹è±¡ï¼Œå…³ç³»è¿ç®—ç±»å‡½æ•°å¯¹è±¡ï¼Œé€»è¾‘è¿ç®—ç±»ä»¿å‡½æ•°ã€‚è¿™äº›ä»¿å‡½æ•°æ‰€äº§ç”Ÿçš„å¯¹è±¡ï¼Œç”¨æ³•å’Œä¸€èˆ¬å‡½æ•°å®Œå…¨ç›¸åŒï¼Œå½“ç„¶æˆ‘ä»¬è¿˜å¯ä»¥äº§ç”Ÿæ— åçš„ä¸´æ—¶å¯¹è±¡æ¥å±¥è¡Œå‡½æ•°åŠŸèƒ½ã€‚ä½¿ç”¨å†…å»ºå‡½æ•°å¯¹è±¡ï¼Œéœ€è¦å¼•å…¥å¤´æ–‡ä»¶`#include<fictional>`

6ä¸ªç®—æ•°ç±»å‡½æ•°å¯¹è±¡ï¼Œé™¤äº†negateæ˜¯ä¸€å…ƒè¿ç®—ï¼Œå…¶ä»–éƒ½æ˜¯äºŒå…ƒè¿ç®—ã€‚

```c++
tempLate<cLass T>T plus<T>//åŠ æ³•ä»¿å‡½æ•°
template<cLass T>T minus<T>//å‡æ³•ä»¿å‡½æ•°
tempLate<cLass T>T multiplies<T>//ä¹˜æ³•ä»¿å‡½æ•°
tempLate.<cLass T>T divides<T)//é™¤æ³•ä»¿å‡½æ•°
tempLate<cLass T>T moduLus<T>//å–æ¨¡ä»¿å‡½æ•°
tempLate<cLass T>T negate<T>//å–åä»¿å‡½æ•°
```

6ä¸ªå…³ç³»è¿ç®—ç±»å‡½æ•°å¯¹è±¡ï¼Œæ¯ä¸€ç§éƒ½æ˜¯äºŒå…ƒè¿ç®—ã€‚

```c++
tempLate<cLass T>bool equal_to<T>//ç­‰äº
template.<cLass T>bool not_equal_.to<T>//ä¸ç­‰äº
tempLate<cLass T>bool greater<T>//
template<cLass T)bool greater_equal<T>//å¤§äºç­‰äº
tempLate<cLass T>bool less<T>//å°äº
template<cLass T>bool less_equal<T>//å°äºç­‰äº
```

é€»è¾‘è¿ç®—ç±»è¿ç®—å‡½æ•°ï¼Œnotä¸ºä¸€å…ƒè¿ç®—ï¼Œå…¶ä½™ä¸ºäºŒå…ƒè¿ç®—ã€‚

```c++
tempLate<cLass T>bool logical_and<T>//é€»è¾‘ä¸
tempLate<cLass T>bool logical or<T>//é€»è¾‘æˆ–
tempLate<cLass T)bool logical_not<T>//é€»è¾‘é
```



### å‡½æ•°å¯¹è±¡çš„é€‚é…å™¨

```c++
#include <iostream>
#include <vector>
#include <algorithm>
#include <functional>
using namespace std;

class Adapter1st: public binary_function<int, int,void>
{
public:
	void operator()(int i, int val) const
	{
		cout << i << "+" << val << "=" << i + val << endl;
	}

};

class Compare
{
public:
	bool operator()(int a, int b)
	{
		return a > b;
	}
};
struct print
{
	void operator()(int a) { cout << a << endl; }
};

void test()
{
	vector<int> v;
	v.push_back(1);
	v.push_back(3);
	v.push_back(6);
	v.push_back(11);
	v.push_back(5);
	for_each(v.begin(), v.end(), bind2nd(Adapter1st(), 2));
	sort(v.begin(), v.end(), Compare());
	for_each(v.begin(), v.end(), print());
	for_each(v.begin(), v.end(), bind2nd(Adapter1st(), 2));

}

int main()
{
	test();
}

```





## æ™ºèƒ½æŒ‡é’ˆ

### ä»€ä¹ˆæ˜¯æ™ºèƒ½æŒ‡é’ˆï¼Ÿ

æ™ºèƒ½æŒ‡é’ˆæ˜¯å­˜å‚¨æŒ‡å‘åŠ¨æ€åˆ†é…ï¼ˆä½äºå †ï¼‰å¯¹è±¡æŒ‡é’ˆçš„ç±»ï¼Œç”¨äºç”Ÿå­˜æœŸæ§åˆ¶ï¼Œèƒ½ç¡®ä¿åœ¨ç¦»å¼€æŒ‡é’ˆæ‰€åœ¨ä½œç”¨åŸŸæ—¶ï¼Œè‡ªåŠ¨æ­£ç¡®åœ°é”€æ¯åŠ¨æ€åˆ†é…çš„å¯¹è±¡ï¼Œä»¥é˜²æ­¢å†…å­˜æ³„æ¼ã€‚

æ™ºèƒ½æŒ‡é’ˆé€šå¸¸é€šè¿‡å¼•ç”¨è®¡æ•°æŠ€æœ¯å®ç°ï¼šæ¯ä½¿ç”¨ä¸€æ¬¡ï¼Œå†…éƒ¨å¼•ç”¨è®¡æ•°+1ï¼›æ¯ææ„ä¸€æ¬¡ï¼Œå†…éƒ¨å¼•ç”¨è®¡æ•°-1ï¼Œå½“å‡ä¸º0æ—¶ï¼Œåˆ é™¤æ‰€æŒ‡å †å†…å­˜ã€‚

C++11æä¾›3ç§æ™ºèƒ½æŒ‡é’ˆï¼šstd::shared_ptr, std::unique_ptr, std::weak_ptr

å¤´æ–‡ä»¶ï¼š

ä¸‹é¢å›´ç»•è¿™è¿™ç§æ™ºèƒ½æŒ‡é’ˆè¿›è¡Œæ¢è®¨ã€‚

### shared_ptr

shared_ptræ˜¯å…±äº«çš„æ™ºèƒ½æŒ‡é’ˆï¼Œä½¿ç”¨å¼•ç”¨è®¡æ•°ï¼Œå…è®¸å¤šä¸ªshared_ptræŒ‡é’ˆæŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ã€‚åªæœ‰åœ¨æœ€åä¸€ä¸ªshared_ptrææ„æ—¶ï¼Œå¼•ç”¨è®¡æ•°ä¸º0ï¼Œå†…å­˜æ‰ä¼šè¢«é‡Šæ”¾ã€‚

#### shared_ptråŸºæœ¬ç”¨æ³•

**1. åˆå§‹åŒ–**
å¯ä»¥é€šè¿‡ æ„é€ å‡½æ•°ã€make_sharedè¾…åŠ©å‡½æ•°ã€resetæ–¹æ³• æ¥åˆå§‹åŒ–shared_ptrï¼Œå¦‚ï¼š

```cpp
// æ™ºèƒ½æŒ‡é’ˆçš„åˆå§‹åŒ–æ–¹å¼
shared_ptr<int> p(new int(1)); // ä¼ å‚æ„é€ 
shared_ptr<int> p2 = p; // copyæ„é€ 
shared_ptr<int> p3; // åˆ›å»ºç©ºçš„shared_ptrï¼Œä¸æŒ‡å‘ä»»ä½•å†…å­˜
p3.reset(new int(2)); // resetæ–¹æ³• æ›¿æ¢p3ç®¡ç†å¯¹è±¡æŒ‡é’ˆä¸ºä¼ å…¥æŒ‡é’ˆå‚æ•°
auto p4 = make_shared<int>(3); // åˆ©ç”¨make_sharedè¾…åŠ©å‡½æ•°ï¼Œåˆ›å»ºshared_ptr

if (p3) 
	cout << "p3 is not null" << endl;

else 
	cout << "p3 is null" << endl;
```

åº”è¯¥ä¼˜å…ˆä½¿ç”¨make_sharedåˆ›å»ºæ™ºèƒ½æŒ‡é’ˆï¼Œå› ä¸ºæ›´é«˜æ•ˆã€‚
**TIPSï¼š**
1ï¼‰å¦‚æœæ™ºèƒ½æŒ‡é’ˆä¸­å¼•ç”¨è®¡æ•° > 0ï¼Œresetå°†å¯¼è‡´å¼•ç”¨è®¡æ•°-1ï¼›
2ï¼‰é™¤äº†é€šè¿‡å¼•ç”¨è®¡æ•°ï¼Œè¿˜å¯ä»¥é€šè¿‡æ™ºèƒ½æŒ‡é’ˆçš„operator boolç±»å‹æ“ä½œç¬¦ï¼Œæ¥åˆ¤æ–­æŒ‡é’ˆæ‰€æŒ‡å†…å®¹æ˜¯å¦ä¸ºç©ºï¼ˆæœªåˆå§‹åŒ–ï¼‰ï¼›

**é”™è¯¯åšæ³•ï¼šå°†ä¸€ä¸ªåŸå§‹æŒ‡é’ˆç›´æ¥èµ‹å€¼ç»™ä¸€ä¸ªæ™ºèƒ½æŒ‡é’ˆã€‚**

```cpp
// é”™è¯¯çš„æ™ºèƒ½æŒ‡é’ˆåˆ›å»ºæ–¹æ³•
shared_ptr<int> p = new int(1); // ç¼–è¯‘é”™è¯¯ï¼Œä¸å…è®¸ç›´å°†åŸå§‹æŒ‡é’ˆèµ‹å€¼ç»™æ™ºèƒ½æŒ‡é’ˆ
```

**2. è·å–åŸå§‹æŒ‡é’ˆ**

é€šè¿‡shared_ptrçš„getæ–¹æ³•æ¥è·å–åŸå§‹æŒ‡é’ˆã€‚å¦‚ï¼š

```cpp
shared_ptr<int> p(new int(1));
int* rawp = p.get();
cout << *rawp << endl; // æ‰“å°1
```

æ³¨æ„ï¼šgetè·å–åŸå§‹æŒ‡é’ˆå¹¶ä¸ä¼šå¼•èµ·å¼•ç”¨è®¡æ•°å˜åŒ–ã€‚

**3. æŒ‡å®šåˆ é™¤å™¨**

æ™ºèƒ½æŒ‡é’ˆçš„é»˜è®¤åˆ é™¤å™¨æ˜¯operator deleteï¼Œåˆå§‹åŒ–çš„æ—¶å€™å¯ä»¥æŒ‡å®šè‡ªå®šä¹‰åˆ é™¤å™¨ã€‚å¦‚ï¼š

```cpp
// è‡ªå®šä¹‰åˆ é™¤å™¨DeleteIntPtr
void DeleteIntPtr(int* p) {
	delete p;
}
shared_ptr<int> p(new int, DeleteIntPtr); // ä¸ºshared_ptræŒ‡å®šè‡ªå®šä¹‰åˆ é™¤å™¨
```

åˆ é™¤å™¨ä½•æ—¶è°ƒç”¨ï¼Ÿ

å½“pçš„å¼•ç”¨è®¡æ•°ä¸º0æ—¶ï¼Œè‡ªåŠ¨è°ƒç”¨åˆ é™¤å™¨DeleteIntPtré‡Šæ”¾å¯¹è±¡çš„å†…å­˜ã€‚åˆ é™¤å™¨å¯ä»¥æ˜¯å‡½æ•°ï¼Œä¹Ÿå¯ä»¥æ˜¯lambdaè¡¨è¾¾å¼ï¼Œç”šè‡³ä»»æ„å¯è°ƒç”¨å¯¹è±¡ã€‚

å¦‚ï¼š

```cpp
// ä¸ºshared_ptræŒ‡å®šåˆ é™¤å™¨ç¤ºä¾‹
shared_ptr<int> p(new int, DeleteIntPtr); // ä¸ºæŒ‡å‘intçš„shared_ptræŒ‡å®šåˆ é™¤å™¨ï¼Œåˆ é™¤å™¨æ˜¯è‡ªå®šä¹‰å‡½æ•°
shared_ptr<int> p1(new int, [](int* p) { delete p; });// åˆ é™¤å™¨æ˜¯lambdaè¡¨è¾¾å¼
	
function<void(int*)> f = DeleteIntPtr;
shared_ptr<int> p2(new int, f); // åˆ é™¤å™¨æ˜¯å‡½æ•°å¯¹è±¡

shared_ptr<int> p3(new int[10], [](int* p) { delete[] p; });   // ä¸ºæŒ‡å‘æ•°ç»„çš„shared_ptræŒ‡å®šåˆ é™¤å™¨
	
shared_ptr<int> p4(new int[10], std::default_delete<int[]>()); // åˆ é™¤å™¨æ˜¯default_delete	
```

shared_ptré»˜è®¤åˆ é™¤å™¨æ˜¯åˆ é™¤delete Tå¯¹è±¡çš„ï¼Œå¹¶ä¸æ˜¯é’ˆå¯¹æ•°ç»„ã€‚å¦‚æœè¦åˆ é™¤æ•°ç»„ï¼Œå°±éœ€è¦ä¸ºæ•°ç»„æŒ‡å®šdelete[]åˆ é™¤å™¨ã€‚æˆ–è€…ï¼Œå¯ä»¥é€šè¿‡å°è£…ä¸€ä¸ªmake_shared_arrayæ–¹æ³•æ¥è®©shared_ptræ”¯æŒæ•°ç»„ï¼š

```cpp
template<typename T>
shared_ptr<T> make_shared_array(size_t size) {
	return shared_ptr<T>(new T[size], default_delete<T[]>());
}
// ä½¿ç”¨make_shared_arrayï¼Œåˆ›å»ºæŒ‡å‘æ•°ç»„çš„shared_ptr
shared_ptr<int> p = make_shared_array<int>(10);
shared_ptr<char> p1 = make_shared_array<char>(10);
```

#### ä½¿ç”¨shared_ptrçš„é™·é˜±

1. **ä¸è¦å°†åŸå§‹æŒ‡é’ˆèµ‹å€¼ç»™shared_ptr**

```cpp
shared_ptr<int> p = new int; // ç¼–è¯‘é”™è¯¯
```

2. **ä¸è¦å°†ä¸€ä¸ªåŸå§‹æŒ‡é’ˆåˆå§‹åŒ–å¤šä¸ªshared_ptr**

```cpp
int* rawp = new int;
shared_ptr<int> p1(rawp);
shared_ptr<int> p2(rawp); // é€»è¾‘é”™è¯¯ï¼Œå¯èƒ½å¯¼è‡´ç¨‹åºå´©æºƒ
```

3. **ä¸è¦åœ¨å‡½æ•°å®å‚ä¸­åˆ›å»ºshared_ptr**

```cpp
void func(shared_ptr<int> p, int a);
int g();

func(shared_ptr<int>(new int), g()); // æœ‰ç¼ºé™·
```

ç”±äºC++çš„å‡½æ•°å‚æ•°è®¡ç®—é¡ºåºåœ¨ä¸åŒçš„ç¼–è¯‘å™¨ï¼ˆä¸åŒçš„é»˜è®¤è°ƒç”¨æƒ¯ä¾‹ï¼‰ä¸‹ï¼Œå¯èƒ½ä¸ä¸€æ ·ï¼Œä¸€èˆ¬ä»å³åˆ°å·¦ï¼Œä¹Ÿå¯èƒ½ä»å·¦åˆ°å³ï¼Œå› è€Œå¯èƒ½çš„è¿‡ç¨‹æ˜¯å…ˆnew intï¼Œç„¶åè°ƒç”¨g()ã€‚å¦‚æœæ°å¥½g()å‘é€å¼‚å¸¸ï¼Œè€Œshared_ptr å°šæœªåˆ›å»ºï¼Œé‚£ä¹ˆintå†…å­˜å°±æ³„æ¼äº†ã€‚

**æ­£ç¡®å†™æ³•æ˜¯å…ˆåˆ›å»ºæ™ºèƒ½æŒ‡é’ˆï¼Œç„¶åè°ƒç”¨å‡½æ•°**ï¼š

```cpp
// å‡½æ•°å‚æ•°æ˜¯shared_ptræ—¶ï¼Œæ­£ç¡®å†™æ³•
shared_ptr<int> p(new int());
f(p, g());
```

4. **é€šè¿‡shared_from_this()è¿”å›thisæŒ‡é’ˆã€‚**ä¸è¦å°†thisæŒ‡é’ˆä½œä¸ºshared_ptrè¿”å›å‡ºæ¥ï¼Œå› ä¸ºthisæœ¬è´¨æ˜¯ä¸€ä¸ªè£¸æŒ‡é’ˆã€‚å› æ­¤ï¼Œç›´æ¥ä¼ thisæŒ‡é’ˆå¯èƒ½å¯¼è‡´é‡å¤ææ„ã€‚

â€‹		ä¾‹å¦‚ï¼Œ

```cpp
// å°†thisä½œä¸ºshared_ptrè¿”å›ï¼Œä»è€Œå¯¼è‡´é‡å¤ææ„çš„é”™è¯¯ç¤ºä¾‹
struct A {
	shared_ptr<A> GetSelf() {
		return shared_ptr<A>(this); // ä¸è¦è¿™æ ·åšï¼Œå¯èƒ½å¯¼è‡´é‡å¤ææ„
	}
	~A() {
		cout << "~A()" << endl;
	}
};

shared_ptr<A> p1(new A);
shared_ptr<A> p2 = p1->GetSelf(); // Açš„å¯¹è±¡å°†è¢«ææ„2æ¬¡ï¼Œä»è€Œå¯¼è‡´ç¨‹åºå´©æºƒ
```

æœ¬ä¾‹ä¸­ï¼Œç”¨åŒä¸€ä¸ªæŒ‡é’ˆï¼ˆthisï¼‰æ„é€ äº†2ä¸ªæ™ºèƒ½æŒ‡é’ˆp1, p2ï¼ˆä¸¤è€…æ— ä»»ä½•å…³è”ï¼‰ï¼Œç¦»å¼€ä½œç”¨åŸŸåï¼Œthisä¼šè¢«æ„é€ çš„2ä¸ªæ™ºèƒ½æŒ‡é’ˆå„è‡ªææ„1æ¬¡ï¼Œä»è€Œå¯¼è‡´é‡å¤ææ„çš„é”™è¯¯ã€‚

æ­£ç¡®è¿”å›thisçš„shared_ptråšæ³•ï¼šè®©ç›®æ ‡ç±»é€šè¿‡æ´¾ç”Ÿstd::enable_shared_from_thisç±»ï¼Œç„¶åä½¿ç”¨base classçš„æˆå‘˜å‡½æ•°shared_from_thisæ¥è¿”å›thisçš„shared_ptrã€‚

```cpp
struct A : public enable_shared_from_this<A> {
	shared_ptr<A> GetSelf() {
		return shared_from_this();
	}
	~A() {
		cout << "~A()" << endl;
	}
};

shared_ptr<A> p1(new A);
shared_ptr<A> p2 = p1->GetSelf(); // OK
cout << p2.use_count() << endl;   // æ‰“å°2ï¼Œæ³¨æ„è¿™é‡Œä¼šå¼•èµ·æŒ‡å‘Açš„raw pointerå¯¹åº”çš„shared_ptrçš„å¼•ç”¨è®¡æ•°+1
```

5. **é¿å…å¾ªç¯å¼•ç”¨ã€‚å¾ªç¯å¼•ç”¨ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ã€‚**

   ä¸€ä¸ªå…¸å‹çš„å¾ªç¯å¼•ç”¨caseï¼š

```cpp
struct A;
struct B;

struct A {
	std::shared_ptr<B> bptr;
	~A() { cout << "A is delete!" << endl; }
};
struct B {
	std::shared_ptr<A> aptr;
	~B() { cout << "B is delete!" << endl; }
};

void test() {
	shared_ptr<A> ap(new A);
	shared_ptr<B> bp(new B);
	ap->bptr = bp;
	bp->aptr = ap;
	// Aå’ŒBå¯¹è±¡åº”è¯¥éƒ½è¢«åˆ é™¤ï¼Œç„¶è€Œå®é™…æƒ…å†µæ˜¯éƒ½ä¸ä¼šè¢«åˆ é™¤ï¼šæ²¡æœ‰è°ƒç”¨ææ„å‡½æ•°
}
```

è§£å†³å¾ªç¯å¼•ç”¨çš„æœ‰æ•ˆæ–¹æ³•æ˜¯ä½¿ç”¨weak_ptrã€‚ä¾‹å­ä¸­ï¼Œå¯ä»¥å°†Aå’ŒBä¸­ä»»æ„ä¸€ä¸ªæˆå‘˜å˜é‡ï¼Œç”±shared_pträ¿®æ”¹ä¸ºweak_ptrã€‚

### unique_ptr

#### unique_ptråŸºæœ¬ç”¨æ³•

ç‹¬å å‹æ™ºèƒ½æŒ‡é’ˆï¼Œä¸å…è®¸ä¸å…¶ä»–æ™ºèƒ½æŒ‡é’ˆå…±äº«å†…éƒ¨æŒ‡é’ˆï¼Œä¸å…è®¸å°†ä¸€ä¸ªunique_ptrèµ‹å€¼ç»™å¦å¤–ä¸€ä¸ªunique_ptrã€‚

é”™è¯¯ç”¨æ³•ï¼š

```cpp
// å°†ä¸€ä¸ªunique_ptrèµ‹å€¼ç»™å¦å¤–ä¸€ä¸ªunique_ptræ˜¯é”™è¯¯çš„
unique_ptr<int> p(new int);
unique_ptr<int> p1 = p;            // é”™è¯¯ï¼Œunique_pträ¸å…è®¸å¤åˆ¶
```

æ­£ç¡®ç”¨æ³•ï¼šå¯ä»¥ç§»åŠ¨ï¼ˆstd::moveï¼‰ã€‚ç§»åŠ¨åï¼ŒåŸæ¥çš„unique_pträ¸å†æ‹¥æœ‰åŸæ¥æŒ‡é’ˆçš„æ‰€æœ‰æƒäº†ï¼Œæ‰€æœ‰æƒç§»åŠ¨ç»™äº†æ–°unique_ptrã€‚

```cpp
unique_ptr<int> p(new int);
unique_ptr<int> p1 = p;            // é”™è¯¯ï¼Œunique_pträ¸å…è®¸å¤åˆ¶
unique_ptr<int> p2 = std::move(p); // OK
```

**è‡ªå®šä¹‰make_uniqueåˆ›å»ºunique_ptr**
shared_ptræœ‰è¾…åŠ©æ–¹æ³•make_sharedå¯ä»¥åˆ›å»ºæ™ºèƒ½æŒ‡é’ˆï¼Œä½†C++11ä¸­æ²¡æœ‰ç±»ä¼¼çš„make_uniqueï¼ˆC++14æ‰æä¾›ï¼‰ã€‚
è‡ªå®šä¹‰make_uniqueæ–¹æ³•ï¼ˆéœ€è¦åœ¨C++11ç¯å¢ƒä¸‹è¿è¡Œï¼‰ï¼š

```cpp
// æ”¯æŒæ™®é€šæŒ‡é’ˆ
template<class T, class... Args> inline
typename enable_if<!is_array<T>::value, unique_ptr<T>>::type
make_unique(Args&&... args) {
	return unique_ptr<T>(new T(std::forward<Args>(args)...));
}

// æ”¯æŒåŠ¨æ€æ•°ç»„
template<class T> inline
typename enable_if<is_array<T>::value && extent<T>::value==0, unique_ptr<T>>::type
make_unique(size_t size) {
	typedef typename remove_extent<T>::type U;
	return unique_ptr<T>(new U[size]());
}

// è¿‡æ»¤æ‰å®šé•¿æ•°ç»„çš„æƒ…å†µ
template<class T, class... Args>
typename enable_if<extent<T>::value != 0, void>::type make_unique(Args&&...) = delete;

// ä½¿ç”¨è‡ªå®šä¹‰make_uniqueåˆ›å»ºunique_ptr
unique_ptr<int> p = make_unique<int>(10);
cout << *p << endl;
```

#### unique_pträ¸shared_ptrçš„åŒºåˆ«

å¦‚æœå¸Œæœ›åŒä¸€æ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ªæ™ºèƒ½æŒ‡é’ˆç®¡ç†èµ„æºï¼Œå°±ç”¨unique_ptrï¼›å¦‚æœå¸Œæœ›å¤šä¸ªæ™ºèƒ½æŒ‡é’ˆç®¡ç†åŒä¸€ä¸ªèµ„æºï¼Œå°±ç”¨shared_ptrã€‚
é™¤äº†ç‹¬å æ€§å¤–ï¼Œunique_pträ¸shared_ptrçš„åŒºåˆ«ï¼š
1ï¼‰unique_ptrå¯ä»¥æŒ‡å‘ä¸€ä¸ªæ•°ç»„ï¼Œshared_pträ¸èƒ½

```cpp
unique_ptr<int []> ptr(new int[10]); // OKï¼šæ™ºèƒ½æŒ‡é’ˆptræŒ‡å‘å…ƒç´ ä¸ªæ•°ä¸º10çš„intæ•°ç»„
ptr[9] = 9; // è®¾ç½®æœ€åä¸€ä¸ªå…ƒç´ ä¸º9

shared_ptr<int []> ptr(new int[10]); // é”™è¯¯ï¼šC++11ä¸­ï¼Œshared_pträ¸èƒ½é€šè¿‡è®©æ¨¡æ¿å‚æ•°ä¸ºæ•°ç»„ï¼Œä»è€Œè®©æ™ºèƒ½æŒ‡é’ˆç›´æ¥æŒ‡å‘æ•°ç»„ï¼Œå› ä¸ºé»˜è®¤åˆ é™¤å™¨æ˜¯deleteï¼Œè€Œæ•°ç»„éœ€è¦delete[]ï¼ˆC++17ä¸­å·²ç»å¯ç”¨æ”¯æŒï¼‰
```

2ï¼‰æŒ‡å®šåˆ é™¤å™¨æ—¶ï¼Œä¸èƒ½åƒshared_ptré‚£æ ·ç›´æ¥ä¼ å…¥lambdaè¡¨è¾¾å¼

```cpp
shared_ptr<int> p(new int(1), [](int* p) { delete p; });  // OK
unique_ptr<int> p2(new int(1), [](int* p) { delete p; }); // é”™è¯¯ï¼šä¸ºunique_ptræŒ‡å®šåˆ é™¤å™¨æ—¶ï¼Œéœ€è¦ç¡®å®šåˆ é™¤å™¨çš„ç±»å‹
```

å› ä¸ºä¸ºunique_ptræŒ‡å®šåˆ é™¤å™¨æ—¶ï¼Œä¸èƒ½åƒshared_ptré‚£æ ·ï¼Œéœ€è¦ç¡®å®šåˆ é™¤å™¨çš„ç±»å‹ã€‚åƒè¿™æ ·ï¼š

```cpp
unique_ptr<int, void(*)(int *)> p2(new int(1), [](int* p) { delete p; }); // OK
```

å¦‚æœlambdaè¡¨è¾¾å¼æ•è·äº†å˜é‡ï¼Œè¿™ç§å†™æ³•å°±æ˜¯é”™è¯¯çš„ï¼š

```cpp
unique_ptr<int, void(*)(int *)> p2(new int(1), [&](int* p) { delete p; }); // é”™è¯¯ï¼šlambdaæ— æ³•è½¬æ¢ä¸ºå‡½æ•°æŒ‡é’ˆ
```

å› ä¸ºlambdaæ²¡æœ‰æ•è·å˜é‡æ—¶ï¼Œå¯ä»¥ç›´æ¥è½¬æ¢ä¸ºå‡½æ•°æŒ‡é’ˆï¼Œè€Œä¸ä¼šå˜é‡åï¼Œæ— æ³•è½¬æ¢ã€‚
å¦‚æœå¸Œæœ›unique_ptråˆ é™¤å™¨æ”¯æŒå·²ä¸ä¼šå˜é‡çš„lambdaï¼Œå¯ä»¥å°†æ¨¡æ¿å®å‚ç”±å‡½æ•°ç±»å‹ä¿®æ”¹ä¸ºstd::functionç±»å‹ï¼ˆå¯è°ƒç”¨å¯¹è±¡ï¼‰ï¼š

```cpp
unique_ptr<int, function<void(int *)>> p2(new int(1), [&](int* p) { delete p; });
```

#### è‡ªå®šä¹‰unique_ptråˆ é™¤å™¨

```cpp
#include <memory>
#include <iostream>
#include <functional>
using namespace std;
struct MyDeleter{
	void operator()(int* p) {
		cout << "delete" << endl;
		delete p;
	}
};

unique_ptr<int, MyDeleter> p(new int(1));
cout << *p << endl;
```

### weak_ptr

å¼±å¼•ç”¨æ™ºèƒ½æŒ‡é’ˆweak_ptrç”¨æ¥ç›‘è§†shared_ptrï¼Œä¸ä¼šå¼•èµ·å¼•ç”¨è®¡æ•°å˜åŒ–ï¼Œä¹Ÿä¸ç®¡ç†shared_ptrå†…éƒ¨æŒ‡é’ˆï¼Œä¸»è¦ä¸ºäº†ç›‘è§†shared_ptrç”Ÿå‘½å‘¨æœŸã€‚weak_ptræ²¡æœ‰é‡è½½æ“ä½œç¬¦*å’Œ->ï¼Œå› ä¸ºä¸å…±äº«æŒ‡é’ˆï¼Œä¸èƒ½æ“ä½œèµ„æºã€‚

weak_pträ¸»è¦ä½œç”¨ï¼š
1ï¼‰ç›‘è§†shared_ptrç®¡ç†çš„èµ„æºæ˜¯å¦å­˜åœ¨ï¼›
2ï¼‰ç”¨æ¥è¿”å›thisæŒ‡é’ˆï¼›
3ï¼‰è§£å†³å¾ªç¯å¼•ç”¨é—®é¢˜ï¼›

#### weak_ptråŸºæœ¬ç”¨æ³•

1ï¼‰é€šè¿‡use_count() è·å¾—å½“å‰è§‚æµ‹èµ„æºçš„å¼•ç”¨è®¡æ•°ã€‚

```cpp
shared_ptr<int> sp(new int(10));
weak_ptr<int> wp(sp);
cout << wp.use_count() << endl; // æ‰“å°1
```

2ï¼‰é€šè¿‡expired() åˆ¤æ–­æ‰€è§‚æµ‹çš„èµ„æºé‡Šæ”¾å·²ç»è¢«é‡Šæ”¾ã€‚

```cpp
{
	shared_ptr<int> sp(new int(10)); // spæ‰€æŒ‡å‘å†…å®¹éç©º
	weak_ptr<int> wp(sp);
	if (wp.expired()) {
		cout << "weak_ptr æ— æ•ˆï¼Œæ‰€ç›‘è§†çš„æ™ºèƒ½æŒ‡é’ˆå·²ç»è¢«é‡Šæ”¾" << endl;
	}
	else
		cout << "weak_ptr æœ‰æ•ˆ" << endl; // è¾“å‡º "weak_ptr æœ‰æ•ˆ"
}
{
	shared_ptr<int> sp; // spæ‰€æŒ‡å‘çš„å†…å®¹ä¸ºç©º
	weak_ptr<int> wp(sp);
	if (wp.expired()) {
		cout << "weak_ptr æ— æ•ˆï¼Œæ‰€ç›‘è§†çš„æ™ºèƒ½æŒ‡é’ˆå·²ç»è¢«é‡Šæ”¾" << endl; // è¾“å‡º "weak_ptr æ— æ•ˆ..."
	}
	else
		cout << "weak_ptr æœ‰æ•ˆ" << endl;
}
```

3ï¼‰é€šè¿‡lock() è·å–æ‰€ç›‘è§†çš„shared_ptrã€‚

```cpp
weak_ptr<int> wp;
void f() {
	shared_ptr<int> sp(new int(10));
	wp = sp;

	if (wp.expired()) {
		cout << "weak_ptr æ— æ•ˆï¼Œæ‰€ç›‘è§†çš„æ™ºèƒ½æŒ‡é’ˆå·²ç»è¢«é‡Šæ”¾" << endl;
	}
	else {
		cout << "weak_ptr æœ‰æ•ˆ" << endl; // æ‰“å° "weak_ptr æœ‰æ•ˆ"
		auto spt = wp.lock();
		cout << *spt << endl; // æ‰“å°10
	}
}
```

#### weak_ptrè¿”å›thisæŒ‡é’ˆ

ä¸Šæ–‡æåˆ°ä¸èƒ½ç›´æ¥å°†thisæŒ‡é’ˆè¿”å›ä¸ºshared_ptrï¼Œéœ€è¦é€šè¿‡ç»§æ‰¿enable_shared_from_thisç±»ï¼Œç„¶åé€šè¿‡ç»§æ‰¿çš„shared_from_this()è®¿é—®æ¥è¿”å›æ™ºèƒ½æŒ‡é’ˆã€‚è¿™æ˜¯å› ä¸ºenable_shared_from_thisç±»ä¸­æœ‰ä¸ªweak_ptrï¼Œç”¨äºç›‘æµ‹thisæ™ºèƒ½æŒ‡é’ˆï¼Œè°ƒç”¨shared_from_this()æ–¹æ³•æ—¶ï¼Œä¼šè°ƒç”¨å†…éƒ¨weak_ptrçš„lock()æ–¹æ³•ï¼Œå°†ç›‘æµ‹çš„shared_ptrè¿”å›ã€‚

ä¹‹å‰æåˆ°çš„é‚£ä¸ªä¾‹å­ï¼š

```cpp
struct A : public std::enable_shared_from_this<A> {
	std::shared_ptr<A> GetSelf() {
		return shared_from_this();
	}
	~A() {
		cout << "A is deleted" << endl;
	}
};

shared_ptr<A> spy(new A);
shared_ptr<A> p = spy->GetSelf(); // OK. å¦‚æœAä¸ç”¨ç»§æ‰¿è‡ªenable_shared_from_thisç±»çš„æ–¹æ³•ï¼Œç›´æ¥ä¼ thisæŒ‡é’ˆç»™shared_ptrï¼Œä¼šå¯¼è‡´é‡å¤ææ„çš„é—®é¢˜

// åªä¼šè¾“å‡ºä¸€æ¬¡ "A is deleted"
```

#### weak_ptrè§£å†³å¾ªç¯å¼•ç”¨é—®é¢˜

å‰é¢æåˆ°shared_ptrå­˜åœ¨çš„å¾ªç¯å¼•ç”¨çš„ç»å…¸é—®é¢˜ï¼šAç±»æŒæœ‰æŒ‡å‘Bå¯¹è±¡çš„shared_ptrï¼ŒBç±»æŒæœ‰æŒ‡å‘Aå¯¹è±¡çš„shared_ptrï¼Œå¯¼è‡´2ä¸ªshared_ptrå¼•ç”¨è®¡æ•°æ— æ³•å½’0ï¼Œä»è€Œå¯¼è‡´shared_ptræ‰€æŒ‡å‘å¯¹è±¡æ— æ³•æ­£å¸¸é‡Šæ”¾ã€‚

```cpp
struct A;
struct B;

struct A {
	shared_ptr<B> bptr;
	~A() { cout << "A is deleted" << endl; }
};
struct B {
	shared_ptr<A> bptr;
	~B() { cout << "B is deleted" << endl; }
};

void test() {
	shared_ptr<A> pa(new A);
	shared_ptr<B> pb(new B);
	pa->bptr = pb;
	pb->aptr = pa;
} // ç¦»å¼€å‡½æ•°ä½œç”¨åŸŸåï¼ŒAã€Bå¯¹è±¡åº”è¯¥é”€æ¯ï¼Œä½†äº‹å®æ²¡æœ‰è¢«é”€æ¯ï¼Œä»è€Œå¯¼è‡´å†…å­˜æ³„æ¼
```

ç”¨weak_ptrè§£å†³å¾ªç¯å¼•ç”¨é—®é¢˜ï¼Œå…·ä½“æ–¹æ³•æ˜¯å°†Aæˆ–Bç±»ä¸­ï¼Œshared_ptrç±»å‹ä¿®æ”¹ä¸ºweak_ptrã€‚

```cpp
struct A;
struct B;

struct A {
	shared_ptr<B> bptr;
	~A() { cout << "A is deleted" << endl; }
};

struct B {
	weak_ptr<A> aptr; // å°†Bä¸­æŒ‡å‘Aå¯¹è±¡çš„æ™ºèƒ½æŒ‡é’ˆï¼Œç”±shared_pträ¿®æ”¹ä¸ºweak_ptr
	~B() { cout << "B is deleted" << endl; }
};

void test() {
	shared_ptr<A> pa(new A);
	shared_ptr<B> pb(new B);
	pa->bptr = pb;
	pb->aptr = pa;
} // OK
```

### é€šè¿‡æ™ºèƒ½æŒ‡é’ˆç®¡ç†ç¬¬ä¸‰æ–¹åº“åˆ†é…çš„å†…å­˜

ç¬¬ä¸‰æ–¹åº“æä¾›çš„æ¥å£ï¼Œé€šå¸¸æ˜¯ç”¨çš„åŸå§‹æŒ‡é’ˆï¼Œè€Œéæ™ºèƒ½æŒ‡é’ˆã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬åœ¨ç”¨å®Œç¬¬ä¸‰æ–¹åº“ä¹‹åï¼Œå¦‚ä½•é€šè¿‡æ™ºèƒ½æŒ‡é’ˆç®¡ç†ç¬¬ä¸‰æ–¹åº“åˆ†é…çš„å†…å­˜å‘¢ï¼Ÿ

æˆ‘ä»¬å…ˆçœ‹ç¬¬ä¸‰æ–¹åº“ä¸€èˆ¬çš„ç”¨æ³•ï¼š

```cpp
// GetHandler()è·å–ç¬¬ä¸‰æ–¹åº“å¥æŸ„
// Create, Releaseæ˜¯ç¬¬ä¸‰æ–¹åº“æä¾›çš„èµ„æºåˆ›å»ºã€é‡Šæ”¾æ¥å£
void* p = GetHandler()->Create();
// do something...
GetHandler()->Release();
```

å®é™…ä¸Šï¼Œä¸Šé¢è¿™æ®µä»£ç æ˜¯ä¸å®‰å…¨çš„ï¼ŒåŸå› åœ¨äºï¼š1ï¼‰ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“åˆ†é…æ—¶ï¼Œå¯èƒ½å¿˜è®°è°ƒç”¨Releaseæ¥å£ï¼›2ï¼‰å‘ç”Ÿäº†å¼‚å¸¸ï¼Œæˆ–è€…æå‰è¿”å›ï¼Œå®é™…å¹¶æ²¡æœ‰è°ƒç”¨Releaseæ¥å£ã€‚ä»è€Œå¯¼è‡´èµ„æºæ— æ³•æ­£å¸¸é‡Šæ”¾ã€‚

ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆç®¡ç†ç¬¬ä¸‰æ–¹åº“ï¼Œä¸è¦æ˜¾å¼è°ƒç”¨é‡Šæ”¾æ¥å£ï¼Œå³ä½¿å‘ç”Ÿå¼‚å¸¸æˆ–è€…å¿˜è®°è°ƒç”¨ï¼Œä¹Ÿèƒ½æ­£å¸¸é‡Šæ”¾èµ„æºã€‚
å¦‚ä¸Šé¢ä¸€èˆ¬ç”¨æ³•ï¼Œå¯ä»¥æ”¹å†™æˆç”¨æ™ºèƒ½æŒ‡é’ˆçš„æ–¹å¼ï¼š

```cpp
// OK
void* p = GetHandler()->Create();
shared_ptr<void> sp(p, [this](void* p) { GetHandle()->Release(p); };
```

ä¸Šé¢ä»£ç å¯ä»¥ä¿è¯ä»»ä½•æ—¶å€™ï¼Œéƒ½èƒ½æ­£ç¡®é‡Šæ”¾ç¬¬ä¸‰æ–¹åº“åˆ†é…çš„å†…å­˜ã€‚è™½ç„¶èƒ½è§£å†³é—®é¢˜ï¼Œä½†è¿˜å¾ˆç¹çï¼Œå› ä¸ºæ¯ä¸ªç¬¬ä¸‰æ–¹åº“åˆ†é…å†…å­˜çš„åœ°æ–¹ï¼Œå°±è¦è°ƒç”¨è¿™æ®µä»£ç ã€‚å¯å°†è¿™æ®µä»£ç æç‚¼å‡ºæ¥ä½œä¸ºä¸€ä¸ªå…¬å…±å‡½æ•°ï¼Œä»¥ç®€åŒ–è°ƒç”¨ï¼š

```cpp
// å­˜åœ¨å®‰å…¨éšæ‚£
// å°†åˆ›å»ºæ™ºèƒ½æŒ‡é’ˆï¼Œç”¨äºç®¡ç†ç¬¬ä¸‰æ–¹åº“çš„ä»£ç æ®µå°è£…åˆ°ä¸€ä¸ªå‡½æ•°
shared_ptr<void> Guard(void* p) {
	return shared_ptr<void> sp(p, [this](void* p) { GetHandler()->Release(p); });
}

void* p = GetHandler()->Create();
auto sp = Guard(p);
// do something with sp...
```

ä¸Šé¢è¿™æ®µä»£ç å­˜åœ¨å®‰å…¨éšæ‚£ï¼šå®¢æˆ·å¯èƒ½å¹¶ä¸ä¼šåˆ©ç”¨Guardè¿”å›çš„ä¸´æ—¶shared_ptrï¼Œæ„é€ ä¸€ä¸ªæ–°çš„shared_ptrï¼Œè¿™æ ·pæ‰€åˆ›å»ºçš„èµ„æºä¼šç«‹å³é‡Šæ”¾ã€‚

```cpp
// å®‰å…¨éšæ‚£æ¼”ç¤º
void* p = GetHandler()->Create();
Guard(p); // è¯¥å¥ç»“æŸåï¼Œpå°±ä¼šè¢«é‡Šæ”¾
// do something with p...
```

è¿™ç§è°ƒç”¨æ–¹å¼ä¸­ï¼ŒGuard(p)æ˜¯ä¸€ä¸ªå³å€¼ï¼Œè¯­å¥ç»“æŸååˆ›å»ºçš„èµ„æºä¼šç«‹å³é‡Šæ”¾ï¼Œä»è€Œå¯¼è‡´pæå‰é‡Šæ”¾ï¼Œpæˆä¸ºé‡æŒ‡é’ˆï¼Œè€Œåé¢ç»§ç»­è®¿é—®på¯èƒ½å¯¼è‡´ç¨‹åºå¼‚å¸¸ã€‚è™½ç„¶ç”¨`auto sp = Guard(p);`èµ‹å€¼ä¸å­˜åœ¨é—®é¢˜ï¼Œä½†æ˜¯å®¢æˆ·å¯èƒ½ä¼šå¿˜è®°ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ç§å†™æ³•ä¸å¤Ÿå®‰å…¨ã€‚

**å¦‚ä½•è§£å†³ç”±äºå¿˜è®°èµ‹å€¼å¯¼è‡´æŒ‡é’ˆæå‰é‡Šæ”¾çš„é—®é¢˜ï¼Ÿ**
ç­”ï¼šå¯ä»¥ç”¨ä¸€ä¸ªå®æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œé€šè¿‡å®æ¥å¼ºåˆ¶åˆ›å»ºä¸€ä¸ªä¸´æ—¶æ™ºèƒ½æŒ‡é’ˆã€‚ä»£ç å¦‚ï¼š

```cpp
// OK
#define GUARD(p) std::shared_ptr<void> p##p(p, [](void* p) { GetHandler()->Release(p); })

void* p = GetHandler()->Create();
GUARD(p); // å®‰å…¨ï¼šä¼šåœ¨å½“å‰ä½œç”¨åŸŸä¸‹ï¼Œåˆ›å»ºåä¸ºppçš„shared_ptr<void>
```

å½“ç„¶ï¼Œå¦‚æœåªå¸Œæœ›ç”¨ç‹¬å æ€§çš„ç®¡ç†ç¬¬ä¸‰æ–¹åº“çš„èµ„æºï¼Œå¯ä»¥ç”¨unique_ptrã€‚

```cpp
// OK
#define GUARD(p) std::unique_ptr<void, void(*)(int*)> p##p(p, [](void* p) { GetHandler()->Release(p); })
```

**å°ç»“ï¼š**
1ï¼‰ä½¿ç”¨å®å®šä¹‰æ–¹å¼çš„ä¼˜åŠ¿ï¼šå³ä½¿å¿˜è®°å¯¹æ™ºèƒ½æŒ‡é’ˆèµ‹å€¼ï¼Œä¹Ÿèƒ½æ­£å¸¸è¿è¡Œï¼Œå®‰å…¨åˆæ–¹ä¾¿ã€‚
2ï¼‰ä½¿ç”¨GUARDè¿™ç§æ™ºèƒ½æŒ‡é’ˆç®¡ç†ç¬¬ä¸‰æ–¹åº“çš„æ–¹å¼ï¼Œå…¶æœ¬è´¨æ˜¯æ™ºèƒ½æŒ‡é’ˆï¼Œèƒ½åœ¨å„ç§åœºæ™¯ä¸‹æ­£ç¡®é‡Šæ”¾å†…å­˜ã€‚



## Lambda

æ‰€è°“Lambdaæ˜¯ä¸€ä»½åŠŸèƒ½å®šä¹‰å¼ï¼Œå¯ä»¥è¢«å®šä¹‰äºè¯­å¥æˆ–è¡¨è¾¾å¼å†…éƒ¨ï¼Œå› æ­¤å¯ä»¥å°†å…¶å½“ä½œå†…æ•›å‡½æ•°ä½¿ç”¨

`[]{}`æœ€ç®€å•çš„Lambdaè¡¨è¾¾å¼







