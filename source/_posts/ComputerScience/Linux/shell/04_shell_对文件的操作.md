## `sed`介绍

`sed`是linux中提供的一个外部命令，它是一个行（流）编辑器，非交互式的对文件内容进行增删改查的操作，使用者只能在命令行输入编辑命令、指定文件名，然后在屏幕上查看输出。它和文本编辑器有本质的区别。

区别是：

文本编辑器：编辑对象是文件

行编辑器：编辑对象是文件中的行

也就是前者一次处理一个文本，而后者是一次处理一个文本中的一行。这个是我们应该弄清楚且必须牢记的，否者可能无法理解sed的运行原理和使用精髓。

### `sed`数据处理原理

文本中的行放入到缓冲区，然后`sed`在缓冲区处理数据，然后默认输出到标准输出设备上。

## `sed`语法

### `sed`命令语法：

- 用法：`sed [options] {command} [flags] [filename]`
- 命令选项
  - `-e `  script将脚本中指定的命令添加到处理输入时执行的命令中多条件，一行中要有多个操作
  - `-f `  script将文件中指定的命令添加到处理输入时执行的命令中
  - `-n `   抑制自动输出
  - `-i`    编辑文件内容
  - `-i.bak` 修改时同时创建`.bak`备份文件。
    使用扩展的正则表达式
  - `！` 取反（跟在模式条件后与she11有所区别）
- command 对文件干什么 ` sed`常用内部命令
  - `a` 在匹配后面添加
  - `i` 在匹配前面添加
  - `d` 删除
  - `s` 查找替换字符串
  - `c` 更改
  - `y` 转换`N` `D ` `P`
  - `p`打印

- flags
  - `数字` 表示新文本替换的模式
  - `g:` 表示用新文本替换现有文本的全部实例
  - `p:` 表示打印原始的内容
  - `w` filename:将替换的结果写入文件

### `sed`内部命令说明

1. 文件内容增加操作，将数据追加到某个位置之后，使用命令`a`

   ```shell
   #方式一
   sed 'a\要追加的内容' 文件 #表示在所有行的下面追加一行
   #方式二
   sed 'na\要追加的内容' 文件 #表示在第n行的下面追加一行
   #方式三
   sed 'n,ma\要追加的内容' 文件 #表示在n行到m行的下面追加一行
   #方法四
   sed [-r] '/regx/a\要最佳的内容' 文件 #表示符合正则表达的行的下面追加一行
   ```

2. 文件内容增加操作，将数据插入到某个位置之前，使用命令`i`

   ```shell
   # 与追加命令a的用法相似
   # Method 1st
   sed 'i\要插入的内容' filename 
   # Method 2ed
   sed 'ni\要插入的内容' filename
   # Method 3rd
   sed 'n,mi\要插入的内容' filename
   # Method 4rd
   sed [-r] '/regix/i\要插入的内容' filename
   ```

3. 文件内容修改操作--**替换**，将一行中匹配的内容替换为新的数据，使用命令`s`

   ```shell
   # 从标准输出流中做替换，将test替换为text
   echo "this is a test"|sed 's/text/test'
   # this is a text # 输出内容
   sed 's/替换的字符串/被替换的字符串/'
   sed 'ns/替换的字符串/被替换的字符串/'
   sed 'n,ms/替换的字符串/被替换的字符串/'
   sed [-r] '/正则表达/s/替换的字符串/被替换的字符串/'
   ```

4. 文件内容修改操作--更改，将一行中匹配的内容修改为新的数据，使用命令`c`，`c`和`s`的不同点在于`c`是修改匹配到的整行的内容，而`s`只替换改行匹配到的字符串

   ```shell
   sed 'c\要需改的内容' filename #将所有行的内容都替换为要修改的内容
   sed 'nc\要需改的内容' filename 
   sed 'n,mc\要需改的内容' filename 
   sed [-r] '/正则表达/c\要需改的内容' filename 
   
   ```

5. 文件内容修改操作--字符替换，将匹配到的行中的字符进行替换，使用命令`y`

   ```shell
   sed 'y/被替换的字符(可以有多个)/替换字符（与被替换字符一一对应' filename
   sed 'ny/被替换的字符(可以有多个)/替换字符（与被替换字符一一对应' filename
   sed 'n,my/被替换的字符(可以有多个)/替换字符（与被替换字符一一对应' filename
   sed [-r] '/正则表达/y/被替换的字符(可以有多个)/替换字符（与被替换字符一一对应' filename
   ```

6. 文件内容删除，将匹配到的整行删除，使用命令`d`

   ```shell
   sed 'd' filename # 删除所有行
   sed 'nd' filename
   sed 'n,md' filename
   sed [-r] '/regix/d' filename
   ```

7. 文件内容查看，将匹配到的行输出到屏幕上，使用命令`p`

   ```shell
   sed 'p' filename #将所有行输出到屏幕上
   sed 'np' filename
   sed 'n,mp' filename
   sed [-r] '/regix/p' filename 
   ```

   

> 总结:`a`（追加） `i`（向前插入） `c`（行替换） 都用的是反斜杠`\`,其他操作命令使用的是斜杆`/`(除了`d`删除命令和`p`输出命令外，删除命令`d`和输出命令`p`都不需要斜杆`/`)；每一个操作命令都可以用正则表达进行行匹配`/regix/`

### 命令选项说明

在`sed`中，命令选项是对`sed`中的命令的增强

1. `-e` 可以在命令行中使用多个命令

   `sed -e 'command1;command2;command3;...'`

2. `-f` 从文件读取编辑命令，适用于日常重复执行的场景

   ```shell
   #第一步: 将命令写入文件
   s/brown/green
   s/dog/cat
   s/fox/elepant/
   #第二步：使用-f命令选项调用命令文件
   sed -f commandfile filename
   
   ```

3. `-n` 抑制内存输出

4. `-r` 使用正则表达

5. `-i` `sed`做的操作正真修改了文件，且不可逆

6. `-i.bak` 在修改文件之前，先对文件进行备份

从上述的演示中，大家可以看出，数据处理只是在缓存中完成的，并没有实际修
改文件内容，如果需要修改文件内容可以直接使用`-i`命令选项。在这里我需要说明的是`-i`是一个不可逆的操作，一旦修改，如果想复原就很困难，几乎不可能，所建议大家在操作的时候可以备份一下源文件。-命令选项提供了备份功能，比如参数使用`-i.bak`,那么在修改源文件的同时会先备份一个以`.bak`结尾的源文件，然后再进行修改操作。

`sed -i.bak 'command' filename` 执行命令修改文件并备份文件

`sed -i 'command' filename` 执行命令修改文件，不可逆的操作

### 标志

标志是对`sed`中的内部命令做补充说明

- `数字标志`：此标志是一个非零正数，默认情况下，执行替换的时候，如果一行中有多个符合的字符串，如果没有标志位定义，那么只会替换第一个字符串，其他的就被忽略掉了，为了能精确替换，可以使用数字位做定义。
- `g`:将一行中所有匹配的字符串全部替换
- `p`: 打印文本内容，功能类似与`-p`命令选项
- `w filename`: 将修改的内容存入到filename文件中



